<div class="row pt-3">
  <div class="col-md-8">
    <hrm-table [data]="emailList"
      [isServerSide]="false"
      [columns]="columns" 
      [showSearch]="true" 
      (actionClicked)="handleAction($event, updateModal)">
    </hrm-table>
  </div>

  <div class="col-md-4">
      <h1 mat-dialog-title>
        {{ 'manage.email-template.add_email_template_title' | translate }}
      </h1>
      <form class="mt-4 p-3 bg-light border rounded" [formGroup]="form" (ngSubmit)="addEmail(form.value)">
        <div class="row">
          
          <!-- Name -->
          <div class="col-sm-12">
            <!-- <label>Name: <span class="text-danger">*</span></label>
            <input type="text" formControlName="Name" class="form-control">
            <div *ngIf="form.get('Name').touched && form.get('Name').invalid" class="text-danger">
              Name is required.
            </div> -->
            <mat-form-field class="w-100">
              <mat-label>{{ 'manage.email-template.form.name' | translate }}</mat-label>
              <input matInput type="text" formControlName="Name">
              <mat-error
                *ngIf="form.get('Name')?.invalid && (form.get('Name')?.touched || form.get('Name')?.dirty)">
                <span *ngIf="form.get('Name')?.errors?.['required']">
                  {{ 'manage.email-template.form.error.name_required' | translate }}
                </span>
              </mat-error>
            </mat-form-field>
          </div>
      
          <!-- Subject -->
          <div class="col-sm-12 mt-3">
            <!-- <label>Subject: <span class="text-danger">*</span></label>
            <input type="text" formControlName="subject" class="form-control">
            <div *ngIf="form.get('subject').touched && form.get('subject').invalid" class="text-danger">
              Subject is required.
            </div> -->
            <mat-form-field class="w-100">
              <mat-label>{{ 'manage.email-template.form.subject' | translate }}</mat-label>
              <input matInput type="text" formControlName="subject">
              <mat-error
                *ngIf="form.get('subject')?.invalid && (form.get('subject')?.touched || form.get('subject')?.dirty)">
                <span *ngIf="form.get('subject')?.errors?.['required']">
                  {{ 'manage.email-template.form.error.subject_required' | translate }}
                </span>
              </mat-error>
            </mat-form-field>
          </div>
      
          <!-- Template Type / Id -->
          <div class="col-sm-12 mt-3">
            <mat-form-field class="w-100">
              <mat-label>{{ 'manage.email-template.form.template_type' | translate }}</mat-label>
              <mat-select formControlName="templateType">
                <mat-option *ngFor="let type of emailTemplateTypes" [value]="type.emailTemplateTypeId">
                  {{ type.name }}
                </mat-option>
              </mat-select>
              <mat-error
                *ngIf="form.get('templateType')?.invalid && (form.get('templateType')?.touched || form.get('templateType')?.dirty)">
                <span *ngIf="form.get('templateType')?.errors?.['required']">
                  {{ 'manage.email-template.form.error.template_type_required' | translate }}
                </span>
              </mat-error>
            </mat-form-field>
          </div>
      
          <!-- Dropdown (optional: show error if needed) -->
          <div class="col-sm-12 mt-3">
            <!-- <label>Content Data: <span class="text-danger">*</span></label>
            <select (change)="onDropdownChange($event)" class="my-2 py-2 form-control">
              <option selected disabled>- Select -</option>
              <option *ngFor="let option of dropdownOptions" [value]="option.label">{{ option.label }}</option>
            </select> -->
            <mat-form-field class="w-100">
              <mat-label>{{ 'manage.email-template.form.insert_variable' | translate }}</mat-label>
              <mat-select (selectionChange)="onDropdownChange($event)">
                <mat-option value="" disabled>- Select -</mat-option>
                <mat-option *ngFor="let option of dropdownOptions" [value]="option.label">
                  {{ option.label }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
      
          <!-- Quill Editor -->
          <div class="col-sm-12">
            <quill-editor #editor [styles]="{height: 'auto'}" formControlName="contentData"
              [(ngModel)]="editorContent">
            </quill-editor>
            <div *ngIf="form.get('contentData').touched && form.get('contentData').invalid" class="text-danger">
              {{ 'manage.email-template.form.error.content_required' | translate }}
            </div>
          </div>
      
          <!-- Submit Button -->
          <div class="col-sm-12 mt-4">
            <button mat-flat-button color="primary" type="submit" [disabled]="isSubmitting">
              {{ 'manage.email-template.add' | translate }}
            </button>
          </div>
      
        </div>
      </form>
  </div>

<ng-template #updateModal let-modal>
  <div class="d-flex align-items-center justify-content-between">
    <h1 mat-dialog-title>
      {{ 'manage.email-template.modal.update_title' | translate }}
    </h1>
    <button mat-icon-button mat-dialog-close="" class="me-4">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <form [formGroup]="updateForm" (ngSubmit)="updateEmail(updateForm.value)">
    <div mat-dialog-content>
      <div class="row m-0">
        <div class="col-12">
          <div class="form-group">
            <mat-form-field class="w-100">
              <mat-label>{{ 'manage.email-template.form.name' | translate }}</mat-label>
              <input matInput type="text" formControlName="Name">
              <mat-error
                *ngIf="updateForm.get('Name')?.invalid && (updateForm.get('Name')?.touched || updateForm.get('Name')?.dirty)">
                <span *ngIf="updateForm.get('Name')?.errors?.['required']">
                  {{ 'manage.email-template.form.error.name_required' | translate }}
                </span>
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-group mt-2">
            <mat-form-field class="w-100">
              <mat-label>{{ 'manage.email-template.form.subject' | translate }}</mat-label>
              <input matInput type="text" formControlName="subject">
              <mat-error
                *ngIf="updateForm.get('subject')?.invalid && (updateForm.get('subject')?.touched || updateForm.get('subject')?.dirty)">
                <span *ngIf="updateForm.get('subject')?.errors?.['required']">
                  {{ 'manage.email-template.form.error.subject_required' | translate }}
                </span>
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-group mt-2">
            <mat-form-field class="w-100">
              <mat-label>{{ 'manage.email-template.form.template_type' | translate }}</mat-label>
              <mat-select formControlName="templateType">
                <mat-option *ngFor="let type of emailTemplateTypes" [value]="type.emailTemplateTypeId">
                  {{ type.name }}
                </mat-option>
              </mat-select>
              <mat-error
                *ngIf="updateForm.get('templateType')?.invalid && (updateForm.get('templateType')?.touched || updateForm.get('templateType')?.dirty)">
                <span *ngIf="updateForm.get('templateType')?.errors?.['required']">
                  {{ 'manage.email-template.form.error.template_type_required' | translate }}
                </span>
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-group mt-2">
            <mat-form-field class="w-100">
              <mat-label>{{ 'manage.email-template.form.insert_variable' | translate }}</mat-label>
              <mat-select (selectionChange)="onUpdate($event)">
                <mat-option value="" disabled>- Select -</mat-option>
                <mat-option *ngFor="let option of dropdownOptions" [value]="option.label">
                  {{ option.label }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="form-group mt-2">
            <label>{{ 'manage.email-template.form.content_data' | translate }}</label>
            <quill-editor #editor [styles]="{height: '100px'}" formControlName="contentData"></quill-editor>
            <div *ngIf="updateForm.get('contentData')?.invalid && (updateForm.get('contentData')?.touched || updateForm.get('contentData')?.dirty)" class="text-danger">
              {{ 'manage.email-template.form.error.content_required' | translate }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div mat-dialog-actions class="d-flex align-items-center justify-content-between">
      <button mat-flat-button mat-dialog-close="">
        {{ 'email-template.cancel' | translate }}
      </button>
      <button mat-flat-button color="primary" type="submit" [disabled]="!updateForm.valid">
        {{ 'email-template.update' | translate }}
      </button>
    </div>
  </form>
</ng-template>
