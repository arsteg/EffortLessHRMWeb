<div>
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
        <div>

            <!-- Basic Information -->
            <mat-accordion>
                <mat-expansion-panel [expanded]="expandedPanels.basic" (opened)="expandedPanels.basic = true" (closed)="expandedPanels.basic = false">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Basic Information
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="row">
                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>First Name </mat-label>
                            <input matInput formControlName="firstName" placeholder="Enter First Name">
                            <mat-error *ngIf="userForm.get('firstName')?.touched && userForm.get('firstName')?.invalid">
                                <small *ngIf="userForm.get('firstName')?.errors?.['required']">First Name is
                                    required.</small>
                                <small *ngIf="userForm.get('firstName')?.errors?.['pattern']">Must contain at least 2
                                    alphabetic characters.</small>
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Last Name </mat-label>
                            <input matInput formControlName="lastName" placeholder="Enter Last Name">
                            <mat-error *ngIf="userForm.get('lastName')?.touched && userForm.get('lastName')?.invalid">
                                <small *ngIf="userForm.get('lastName')?.errors?.['required']">Last Name is
                                    required.</small>
                                <small *ngIf="userForm.get('lastName')?.errors?.['pattern']">Must contain at least 2
                                    alphabetic characters.</small>
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <div class="row">
                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Job Title</mat-label>
                            <input matInput formControlName="jobTitle" placeholder="Enter Job Title">
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Role </mat-label>
                            <mat-select formControlName="role">
                                <mat-option value="" disabled>Select Role</mat-option>
                                <mat-option *ngFor="let role of roles" [value]="role?.id">{{ role?.name }}</mat-option>
                            </mat-select>
                            <mat-error *ngIf="userForm.get('role')?.touched && userForm.get('role')?.invalid">
                                <small *ngIf="userForm.get('role')?.errors?.['required']">Role is required.</small>
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <div class="row">
                        <!-- <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Email</mat-label>
                            <input matInput type="email" formControlName="email" placeholder="Enter Email">
                        </mat-form-field> -->

                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Gender</mat-label>
                            <mat-select formControlName="Gender">
                                <mat-option value="male">Male</mat-option>
                                <mat-option value="female">Female</mat-option>
                                <mat-option value="other">Other</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </mat-expansion-panel>

                <!-- Personal Details -->
                <mat-expansion-panel [expanded]="expandedPanels.personal" (opened)="expandedPanels.personal = true" (closed)="expandedPanels.personal = false">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Personal Details
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="row">
                        <mat-form-field class="col-md-6">
                            <mat-label>Date of Birth (DOB)</mat-label>
                            <input matInput [matDatepicker]="dobPicker" formControlName="DOB" readonly  [max]="maxDate">
                            <mat-hint>MM/DD/YYYY</mat-hint>
                            <mat-datepicker-toggle matIconSuffix [for]="dobPicker"></mat-datepicker-toggle>
                            <mat-datepicker #dobPicker></mat-datepicker>
                            <mat-error *ngIf="userForm.get('DOB')?.hasError('minimumAge') && userForm.get('DOB')?.touched">
                                You must be at least 18 years old.
                              </mat-error>                            
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Marital Status</mat-label>
                            <mat-select formControlName="MaritalStatus">
                                <mat-option value="Unmarried">Unmarried</mat-option>
                                <mat-option value="Married">Married</mat-option>
                                <mat-option value="Other">Other</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>

                    <div class="row">
                        <mat-form-field class="col-md-6">
                            <mat-label>Marriage Anniversary</mat-label>
                            <input matInput [matDatepicker]="marriagePicker" formControlName="MarraigeAniversary" readonly [max]="maxDate">
                            <mat-hint>MM/DD/YYYY</mat-hint>
                            <mat-datepicker-toggle matIconSuffix [for]="marriagePicker"></mat-datepicker-toggle>
                            <mat-datepicker #marriagePicker></mat-datepicker>
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>PAN Card</mat-label>
                            <input matInput formControlName="Pancard" placeholder="Enter PAN Card Number">
                            <mat-error *ngIf="userForm.get('Pancard')?.hasError('required') && userForm.get('Pancard')?.touched">
                                PAN Card Number is required.
                              </mat-error>
                              <mat-error *ngIf="userForm.get('Pancard')?.hasError('invalidPAN') && userForm.get('Pancard')?.touched">
                                PAN Card Number must be 10 characters (5 letters, 4 digits, 1 letter, e.g., ABCDE1234F).
                              </mat-error>
                        </mat-form-field>
                    </div>

                    <div class="row">
                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Aadhar Number</mat-label>
                            <input matInput formControlName="AadharNumber" placeholder="Enter Aadhar Number">
                            <mat-error *ngIf="userForm.get('AadharNumber')?.hasError('required') && userForm.get('AadharNumber')?.touched">
                                Aadhar Number is required.
                              </mat-error>
                              <mat-error *ngIf="userForm.get('AadharNumber')?.hasError('digitsOnly') && userForm.get('AadharNumber')?.touched">
                                Aadhar Number must contain only digits.
                              </mat-error>
                              <mat-error *ngIf="userForm.get('AadharNumber')?.hasError('invalidAadhar') && userForm.get('AadharNumber')?.touched">
                                Aadhar Number must be exactly 12 digits.
                              </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Disability</mat-label>
                            <mat-select formControlName="Disability">
                                <mat-option value="no">No</mat-option>
                                <mat-option value="yes">Yes</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>

                    <div class="row">
                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Father/Husband Name</mat-label>
                            <input matInput formControlName="FatherHusbandName" placeholder="Enter Name">
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Number of Children</mat-label>
                            <input matInput type="number" formControlName="NoOfChildren"
                                placeholder="Enter Number of Children">
                                <mat-error *ngIf="userForm.get('NoOfChildren')?.touched && userForm.get('NoOfChildren')?.invalid">
                                    <small *ngIf="userForm.get('NoOfChildren')?.errors?.['pattern']">No Of Children must be a 1-digit positive number with no leading zero.</small>
                                </mat-error>  
                        </mat-form-field>
                    </div>

                    <div class="row">
                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Passport</mat-label>
                            <input matInput formControlName="PassportDetails" placeholder="Enter Passport Number">                      
                           
                            <mat-error *ngIf="userForm.get('PassportDetails')?.hasError('invalidPassport') && userForm.get('PassportDetails')?.touched">
                                Passport Number must be 1 uppercase letter followed by 7 digits (e.g., A1234567).
                              </mat-error>
                        </mat-form-field>
                    </div>
                </mat-expansion-panel>

                <!-- Address Details -->
                <mat-expansion-panel [expanded]="expandedPanels.address" (opened)="expandedPanels.address = true" (closed)="expandedPanels.address = false">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Address
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="row">
                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Address</mat-label>
                            <input matInput formControlName="address" placeholder="Enter Address">
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>City</mat-label>
                            <input matInput formControlName="city" placeholder="Enter City">
                        </mat-form-field>
                    </div>

                    <div class="row">
                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>State</mat-label>
                            <input matInput formControlName="state" placeholder="Enter State">
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Pincode</mat-label>
                            <input type="number" matInput formControlName="pincode" placeholder="Enter Pincode">
                            <mat-error *ngIf="userForm.get('pincode')?.touched && userForm.get('pincode')?.invalid">
                                <small *ngIf="userForm.get('pincode')?.errors?.['pattern']">
                                    Pincode must be a 6-digit positive number with no leading zero.
                                </small>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </mat-expansion-panel>

                <!-- Contact -->
                <mat-expansion-panel [expanded]="expandedPanels.contact" (opened)="expandedPanels.contact = true" (closed)="expandedPanels.contact = false">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Contact
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="row">
                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Phone</mat-label>
                            <input type="number" matInput formControlName="phone" placeholder="Enter Phone Number">
                            <mat-error *ngIf="userForm.get('phone')?.touched && userForm.get('phone')?.invalid">
                                <small *ngIf="userForm.get('phone')?.errors?.['pattern']"> Phone must be a 10-digit positive number with no leading zero.</small>
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Mobile</mat-label>
                            <input type="number" matInput formControlName="mobile" placeholder="Enter Mobile Number">
                            <mat-error *ngIf="userForm.get('mobile')?.touched && userForm.get('mobile')?.invalid">
                                <small *ngIf="userForm.get('mobile')?.errors?.['pattern']">Mobile must be a 10-digit positive number with no leading zero.</small>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </mat-expansion-panel>

                <!-- Emergency Contact -->
                <mat-expansion-panel [expanded]="expandedPanels.emergency" (opened)="expandedPanels.emergency = true" (closed)="expandedPanels.emergency = false">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Emergency Contact
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="row">
                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Emergency Contact Name</mat-label>
                            <input matInput formControlName="emergancyContactName" placeholder="Enter Name">
                            <mat-error
                            *ngIf="userForm.get('emergancyContactName')?.invalid && (userForm.get('emergancyContactName')?.touched || userForm.get('emergancyContactName')?.dirty)">
                          
                            <span *ngIf="userForm.get('emergancyContactName')?.errors?.['invalidLabel']">
                                Emergency Contact Name cannot contain spaces, numbers, or symbols.
                            </span>
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="col-md-6">
                            <mat-label>Emergency Contact Number</mat-label>
                            <input matInput type="number" min="0" pattern="[0-9]*" formControlName="emergancyContactNumber" placeholder="Enter Contact Number">
                            <mat-error *ngIf="userForm.get('emergancyContactNumber')?.hasError('digitsOnly') && userForm.get('emergancyContactNumber')?.touched">
                              Emergency Contact Number must contain only digits.
                            </mat-error>                           
                            <mat-error *ngIf="userForm.get('emergancyContactNumber')?.hasError('invalidLength') && userForm.get('emergancyContactNumber')?.touched">
                                Emergency Contact Number must be between 10 and 15 digits.
                            </mat-error>
                          </mat-form-field>
                    </div>
                </mat-expansion-panel>

                <!-- Bank Details -->
                <mat-expansion-panel [expanded]="expandedPanels.bank" (opened)="expandedPanels.bank = true" (closed)="expandedPanels.bank = false">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        Bank Details
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="row">
                      <mat-form-field appearance="outline" class="col-md-6">
                        <mat-label>Bank Name</mat-label>
                        <input matInput formControlName="BankName" placeholder="Enter Bank Name">
                        <mat-error *ngIf="userForm.get('BankName')?.hasError('required') && userForm.get('BankName')?.touched">
                          Bank Name is required.
                        </mat-error>
                        <mat-error *ngIf="userForm.get('BankName')?.hasError('invalidBankName') && userForm.get('BankName')?.touched">
                          Bank Name must contain only letters, spaces, or allowed characters (&, -, .).
                        </mat-error>
                      </mat-form-field>
          
                      <mat-form-field appearance="outline" class="col-md-6">
                        <mat-label>Bank Account Number</mat-label>
                        <input matInput type="number" min="0" pattern="[0-9]*" formControlName="BankAccountNumber" placeholder="Enter Account Number">
                        <mat-error *ngIf="userForm.get('BankAccountNumber')?.hasError('required') && userForm.get('BankAccountNumber')?.touched">
                          Bank Account Number is required.
                        </mat-error>
                        <mat-error *ngIf="userForm.get('BankAccountNumber')?.hasError('digitsOnly') && userForm.get('BankAccountNumber')?.touched">
                          Bank Account Number must contain only digits.
                        </mat-error>                       
                        <mat-error *ngIf="userForm.get('BankAccountNumber')?.hasError('invalidLength') && userForm.get('BankAccountNumber')?.touched">
                            Bank Account Number must be between 9 and 18 digits.
                        </mat-error>
                      </mat-form-field>
                    </div>
          
                    <div class="row">
                      <mat-form-field appearance="outline" class="col-md-6">
                        <mat-label>Bank IFSC Code</mat-label>
                        <input matInput formControlName="BankIFSCCode" placeholder="Enter IFSC Code">
                        <mat-error *ngIf="userForm.get('BankIFSCCode')?.hasError('required') && userForm.get('BankIFSCCode')?.touched">
                          Bank IFSC Code is required.
                        </mat-error>
                        <mat-error *ngIf="userForm.get('BankIFSCCode')?.hasError('invalidIFSC') && userForm.get('BankIFSCCode')?.touched">
                          Bank IFSC Code must be 11 characters (4 letters, 0, 6 digits, e.g., SBIN0001234).
                        </mat-error>
                      </mat-form-field>
          
                      <mat-form-field appearance="outline" class="col-md-6">
                        <mat-label>Bank Branch</mat-label>
                        <input matInput formControlName="BankBranch" placeholder="Enter Bank Branch">
                        <mat-error *ngIf="userForm.get('BankBranch')?.hasError('required') && userForm.get('BankBranch')?.touched">
                          Bank Branch is required.
                        </mat-error>
                        <mat-error *ngIf="userForm.get('BankBranch')?.hasError('invalidBankBranch') && userForm.get('BankBranch')?.touched">
                          Bank Branch must contain only letters, spaces, or allowed characters (&, -, .).
                        </mat-error>
                      </mat-form-field>
                    </div>
          
                    <div class="row">
                      <mat-form-field appearance="outline" class="col-md-6">
                        <mat-label>Bank Address</mat-label>
                        <input matInput formControlName="BankAddress" placeholder="Enter Bank Address">
                        <mat-error *ngIf="userForm.get('BankAddress')?.hasError('required') && userForm.get('BankAddress')?.touched">
                          Bank Address is required.
                        </mat-error>
                        <mat-error *ngIf="userForm.get('BankAddress')?.hasError('invalidBankAddress') && userForm.get('BankAddress')?.touched">
                          Bank Address must contain only letters, numbers, spaces, or allowed characters (,.\/-).
                        </mat-error>
                      </mat-form-field>
                    </div>
                  </mat-expansion-panel>

                <!-- Extra Details -->
                <mat-expansion-panel [expanded]="expandedPanels.extra" (opened)="expandedPanels.extra = true" (closed)="expandedPanels.extra = false">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Extra Details
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="row">
                        <mat-form-field appearance="outline" class="col-md-12">
                            <mat-label>Extra Details</mat-label>
                            <textarea matInput
            formControlName="extraDetails"
            maxlength="500"
            placeholder="Enter Extra Details">
  </textarea>
  <mat-hint align="end">{{ userForm.get('extraDetails')?.value?.length || 0 }}/500</mat-hint>

  <mat-error *ngIf="userForm.get('extraDetails')?.hasError('maxlength') && userForm.get('extraDetails')?.touched">
    Maximum 500 characters allowed.
  </mat-error>
                        </mat-form-field>
                    </div>
                </mat-expansion-panel>
            </mat-accordion>

            <!-- Submit Button -->
            <div class="d-flex justify-content-end mt-3">
                <button mat-flat-button type="submit" color="primary">Submit</button>
                <button mat-stroked-button type="button" class="ms-2" (click)="onResetForm()">Cancel</button>
            </div>
        </div>
    </form>
</div>