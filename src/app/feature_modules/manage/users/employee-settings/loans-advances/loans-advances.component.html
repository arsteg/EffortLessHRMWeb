<div class="main-content mt-2">
  <div class="container-fluid">
    <div class="position-relative">
      <button mat-flat-button class="position-absolute end-0" color="primary" (click)="isEdit = false; openDialog()">
        {{ 'loans-advances.add' | translate }}
      </button>
    </div>
    <hrm-table 
      [data]="loansAdvances" 
      [isServerSide]="true" 
      [columns]="columns" 
      [showExport]="'none'" 
      [showSearch]="true" 
      [totalItems]="totalRecords" 
      (actionClicked)="handleAction($event)" 
      (pageChanged)="onPageChange($event)" 
      (sortChanged)="onSortChange($event)" 
      (searchChanged)="onSearchChange($event)">
    </hrm-table>
  </div>
</div>
  
  <ng-template #dialogTemplate let-dialogRef="dialogRef">
    <div class="d-flex align-items-center justify-content-between">
      <h1 mat-dialog-title>
        {{ (isEdit ? 'loans-advances.form.update_title' : 'loans-advances.form.add_title') | translate }}
      </h1>
      <button mat-icon-button mat-dialog-close="" class="me-4">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <form [formGroup]="loansAdvancesForm" (ngSubmit)="onSubmission()">
      <div mat-dialog-content>
        <mat-form-field appearance="outline" class="pt-2 w-100">
          <mat-label>{{ 'loans-advances.form.category' | translate }}</mat-label>
          <mat-select formControlName="loanAdvancesCategory">
            <mat-option value="" disabled>{{ 'loans-advances.form.category_placeholder' | translate }}</mat-option>
            <mat-option [value]="loansAdvancesCatgeory?._id"
              *ngFor="let loansAdvancesCatgeory of loansAdvancesCategories">{{loansAdvancesCatgeory?.name}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="loansAdvancesForm.get('loanAdvancesCategory')?.hasError('required')">
            {{ 'loans-advances.form.error.category_required' | translate }}
          </mat-error>
        </mat-form-field>
  
        <mat-form-field appearance="outline" class="w-100 my-2">
          <mat-label>{{ 'loans-advances.form.no_of_installments' | translate }}</mat-label>
          <input matInput type="number" formControlName="noOfInstallment" min="0">
          <mat-error *ngIf="loansAdvancesForm.get('noOfInstallment')?.hasError('required')">
            {{ 'loans-advances.form.error.no_of_installments_required' | translate }}
          </mat-error>
          <mat-error *ngIf="loansAdvancesForm.get('noOfInstallment')?.hasError('min')">
            {{ 'loans-advances.form.error.no_of_installments_min' | translate }}
          </mat-error>
          <mat-error *ngIf="loansAdvancesForm.get('noOfInstallment')?.hasError('max')">
            {{ 'loans-advances.form.error.no_of_installments_max' | translate }}
          </mat-error>
          <mat-error *ngIf="loansAdvancesForm.hasError('exceedSalary')">
            {{ 'loans-advances.form.error.exceed_salary' | translate }}
          </mat-error>
        </mat-form-field>
  
        <mat-form-field appearance="outline" class="w-100 my-2">
          <mat-label>{{ 'loans-advances.form.monthly_installment' | translate }}</mat-label>
          <input matInput type="number" formControlName="monthlyInstallment"  min="0">
          <mat-error *ngIf="loansAdvancesForm.get('monthlyInstallment')?.hasError('required')">
            {{ 'loans-advances.form.error.monthly_installment_required' | translate }}
          </mat-error>
          <mat-error *ngIf="loansAdvancesForm.get('monthlyInstallment')?.hasError('min')">
            {{ 'loans-advances.form.error.monthly_installment_min' | translate }}
          </mat-error>
          <mat-error *ngIf="loansAdvancesForm.get('monthlyInstallment')?.hasError('highEMI')">
            {{ 'loans-advances.form.error.high_emi' | translate }}
          </mat-error>
        </mat-form-field>
  
        <mat-form-field appearance="outline" class="w-100 my-2">
          <mat-label>{{ 'loans-advances.form.total_amount' | translate }}</mat-label>
          <input matInput type="number" formControlName="amount" readonly>
        </mat-form-field>
      </div>

      <div mat-dialog-actions class="d-flex align-items-center justify-content-between">
        <button mat-flat-button type="button" (click)="dialogRef.close()">{{ 'loans-advances.cancel' | translate }}</button>
        <button  mat-flat-button color="primary" type="submit">{{ (isEdit ? 'loans-advances.update' : 'loans-advances.save') | translate }}</button>
      </div>
    </form>
  </ng-template>