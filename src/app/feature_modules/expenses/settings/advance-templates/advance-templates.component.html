<div class="position-relative">
    <button mat-flat-button class="position-absolute end-0" color="primary" 
        (click)="isEdit = false; changeMode = 'Add'; clearselectedRequest(); open(addModal)">
        {{ 'expenses.add_new' | translate }}
    </button>
    </div>
    <hrm-table [data]="dataSource.data" [isServerSide]="true" [columns]="columns" [showExport]="'none'"
        [showSearch]="true" [totalItems]="totalRecords" (actionClicked)="handleAction($event, addModal)"
        (pageChanged)="onPageChange($event)" (sortChanged)="onSortChange($event)"
        (searchChanged)="onSearchChange($event)">
    </hrm-table>

<!-- Add/Update category -->

<ng-template #addModal let-modal>

    <div class="d-flex align-items-center justify-content-between">
        <h1 mat-dialog-title>
            {{isEdit?('expenses.update' | translate): ('expenses.add' | translate)}} {{'expenses.advance_template' |
            translate}}
        </h1>
        <button mat-icon-button mat-dialog-close="" class="me-4">
            <mat-icon>close</mat-icon>
        </button>
    </div>
    <form action="" [formGroup]="addAdvanceTempForm" (ngSubmit)="addAdvanceTemplate()">
        <div mat-dialog-content>

            <mat-form-field class="w-100 mb-2">
                <mat-label>{{'expenses.advance_template_label' | translate}}</mat-label>
                <input type="text" matInput placeholder="Add Custom Label" formControlName="policyLabel" required>
                <mat-error
                    *ngIf="addAdvanceTempForm.get('policyLabel').touched && addAdvanceTempForm.get('policyLabel').invalid">
                    <span *ngIf="addAdvanceTempForm.get('policyLabel').hasError('maxlength')">
                        {{'expenses.category_label_Limit' | translate}}
                    </span>
                    <span *ngIf="addAdvanceTempForm.get('policyLabel')?.errors?.['spacesNotAllowed']">
                        {{ 'expenses.labelNoLeadingOrTrailingSpaces' | translate }}
                    </span>
                    <span *ngIf="addAdvanceTempForm.get('policyLabel')?.errors?.['invalidLabel']">
                        {{ 'expenses.label_invalid' | translate }}
                    </span>
                    <span *ngIf="addAdvanceTempForm.get('policyLabel').hasError('required')">
                        {{'expenses.advance_template_label_error' | translate}}
                    </span>
                </mat-error>
            </mat-form-field>

            <mat-form-field class="w-100 mt-3">
                <mat-label>{{'expenses.select_applicable_categories' | translate}}</mat-label>
                <mat-select multiple formControlName="advanceCategories" required>
                    <mat-option [value]="advanceCategory?._id"
                        *ngFor="let advanceCategory of advanceCategoriesall; let i = index">
                        {{advanceCategory.label}}
                    </mat-option>
                </mat-select>
                <mat-error
                    *ngIf="addAdvanceTempForm.get('advanceCategories').invalid && addAdvanceTempForm.get('advanceCategories').touched">
                    {{'expenses.expense_categories_error' | translate}}
                </mat-error>
            </mat-form-field>

            <div class="mt-2">
                <mat-label>{{'expenses.add_approvers' | translate}}</mat-label>
                <br>
                <mat-radio-group color="primary" formControlName="approvalType" required>
                    <mat-radio-button value="template-wise">{{'expenses.template_wise' | translate}}</mat-radio-button>
                    <mat-radio-button value="employee-wise">{{'expenses.employee_wise' | translate}}</mat-radio-button>
                </mat-radio-group>
                <mat-error
                    *ngIf="addAdvanceTempForm.get('approvalType').invalid && addAdvanceTempForm.get('approvalType').touched">
                    {{'expenses.add_approvers_error' | translate}}
                </mat-error>
            </div>

            <div class="row mt-2" *ngIf="addAdvanceTempForm.get('approvalType').value === 'template-wise'">
                <div class="col-md-6">
                    <mat-form-field class="w-100">
                        <mat-label>{{'expenses.first_approver' | translate}}</mat-label>
                        <mat-select formControlName="firstApprovalEmployee" required>
                            <mat-option [value]="user?.id" *ngFor="let user of users; let i = index">{{user?.firstName |
                                titlecase}} {{user.lastName | titlecase}}</mat-option>
                        </mat-select>
                        <mat-error
                            *ngIf="addAdvanceTempForm.get('firstApprovalEmployee').invalid && addAdvanceTempForm.get('firstApprovalEmployee').touched">
                            {{'expenses.first_approver_error' | translate}}
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>
        </div>
        <div mat-dialog-actions class="d-flex align-items-center justify-content-between">
            <button mat-flat-button type="button" (click)="dialogRef.close()">{{'expenses.cancel' | translate}}</button>
            <button mat-flat-button color="primary" type="submit" [disabled]="isSubmitted">
                {{isEdit?('expenses.update' | translate): ('expenses.add' | translate)}}
            </button>
        </div>
    </form>
</ng-template>