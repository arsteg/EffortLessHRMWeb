<div class="mainContent pt-3 mt-5">
  <div class="container">
    <div class="py-2 px-0 bg-white tableContainer">

      <div class="d-flex justify-content-between align-items-center mb-2 px-3">
        <p class="mb-0">({{groupedAttendanceRecords?.length}}) Records Found</p>
        <div class="d-flex align-items-end">
          <div class="d-flex align-items-center me-2">
            <span class="bi bi-search searchIcon"></span>
            <input class="form-control search" type="text" placeholder="Search..." [(ngModel)]="searchText"
              name="searchText" aria-label="default input example">
          </div>

          <div>
            <label for="monthSelect">Select Month: </label>
            <select id="monthSelect" [(ngModel)]="selectedMonth" (change)="onMonthChange($event)">
              <option *ngFor="let month of months" [value]="month.value">{{ month.name }}</option>
            </select>
          </div>

          <div class="form-group ms-2">
            <label for="year" class="pt-2 pe-3">Full and Final Year</label>
            <select id="year" name="year" class="form-control" [(ngModel)]="selectedYear"
              (change)="onYearChange($event)">
              <option *ngFor="let year of years" [value]="year">{{ year }}</option>
            </select>
          </div>

        </div>

        <div class="d-flex align-items-center" style="display: none !important;">
          <button mat-raised-button class="addBtn rounded-pill mx-3" (click)="uploadAttendanceRecord()">Upload</button>
        </div>
      </div>
      
      <div class="menu-row d-flex flex-nowrap align-items-center overflow-auto">
        <div class="menu-item d-flex align-items-center me-3" role="button">
          <mat-icon class="checkIcon">check</mat-icon>Present
        </div>
        <div class="menu-item d-flex align-items-center me-3" role="button">
          <mat-icon class="absentIcon">clear</mat-icon>Absent
        </div>
        <div class="menu-item d-flex align-items-center me-3" role="button">
          <mat-icon class="in-outIcon">compare_arrows</mat-icon>In/Out
        </div>
        <div class="menu-item d-flex align-items-center me-3" role="button">
          <mat-icon class="incompleteIcon">update</mat-icon>Incomplete Record
        </div>
        <div class="menu-item d-flex align-items-center me-3" role="button">
          <mat-icon class="halfDayIcon">exposure</mat-icon>Halfday
        </div>
        <div class="menu-item d-flex align-items-center me-3" role="button">
          <mat-icon class="weeklyOffIcon">event</mat-icon>Weekly Off
        </div>
        <div class="menu-item d-flex align-items-center me-3" role="button">
          <mat-icon class="holidayIcon">accessibility_new</mat-icon>Holiday
        </div>
        <div class="menu-item d-flex align-items-center me-3" role="button">
          <mat-icon class="leaveIcon">directions_walk</mat-icon>Leave
        </div>
        <div class="menu-item d-flex align-items-center" role="button">
          <mat-icon class="not-applicableIcon">block</mat-icon>Not Applicable
        </div>
      </div>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th class="ps-2" [appSort]="groupedAttendanceRecords" [attr.data-order]="sortOrder" data-name="userName"
                (click)="sortOrder = (sortOrder === 'asc' ? 'desc' : 'asc')">Employee
                <i [class]="sortOrder === 'asc' ? 'bi bi-arrow-up sort-asc' : 'bi bi-arrow-down sort-desc'"></i>
              </th>
              <th *ngFor="let date of currentMonthDates">{{ date | date: 'shortDate' }}</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of groupedAttendanceRecords | search: searchText; let i = index">
              <td>{{user?.userName}}</td>
              <td *ngFor="let date of currentMonthDates; trackBy: trackByDate">
                <ng-container [ngSwitch]="getAttendanceStatus(user, date)">
                  <span *ngSwitchCase="'present'">
                    <mat-icon class="check">check</mat-icon>
                  </span>

                  <span *ngSwitchCase="'leave'">
                    <mat-icon class="leaveIcon"> directions_walk</mat-icon>
                  </span>

                  <span *ngSwitchCase="'holiday'">
                    <mat-icon class="holidayIcon">accessibility_new</mat-icon>
                  </span>

                  <button *ngSwitchCase="'weeklyOff'" class="rounded weekly-off" mat-raised-button type="button">
                    Weekly Off
                  </button>

                  <span *ngSwitchCase="'halfday'">
                    <mat-icon class="halfDayIcon">exposure</mat-icon>
                  </span>

                  <span *ngSwitchCase="'incomplete halfday'" matTooltip="Incomplete Half Day can not be creditted">
                    <mat-icon class="text-danger">clear</mat-icon>
                  </span>

                  <button *ngSwitchCase="'notApplicable'" class="rounded not-applicable" mat-raised-button
                    type="button">
                    N/A
                  </button>

                  <span *ngSwitchCase="'incomplete'">
                    <mat-icon class="incompleteIcon">update</mat-icon>
                  </span>

                  <span *ngSwitchDefault mat-raised-button>
                    <mat-icon class="text-danger">clear</mat-icon>
                  </span>
                </ng-container>
              </td>
              <td>
                <button mat-mini-fab title="View Attendance History" type="button" (click)="viewHistory(user)">
                  <mat-icon color="warn">remove_red_eye</mat-icon>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>