<div class="main-content">
    <!-- <h2 class="ps-4">Resignation Management</h2> -->
    @if(view == 'user') {
        <div class="position-relative d-none d-md-block">
          <button mat-flat-button class="position-absolute end-0" color="primary" data-bs-toggle="offcanvas"
           (click)="isEditMode = false; openDialog()">Create Resignation</button>
        </div>

        <hrm-table
            [data]="resignationRecords" 
            [columns]="columns" 
            (actionClicked)="onActionClick($event)" 
            [isServerSide]="false"
            [showSearch]="true" 
            [totalItems]="totalRecords" 
            [pageSize]="recordsPerPage" 
            (pageChanged)="onPageChange($event)"
            (searchChanged)="onSearchChange($event)">
        </hrm-table>

         <!-- <table mat-table [dataSource]="resignationRecords" class="mt-3 mat-elevation-z8">
          <ng-container matColumnDef="user">
              <th mat-header-cell *matHeaderCellDef> User </th>
              <td mat-cell *matCellDef="let element"> {{getMatchingUser(element?.user)}} </td>
          </ng-container>
          <ng-container matColumnDef="resignation_date">
              <th mat-header-cell *matHeaderCellDef> Resignation Date </th>
              <td mat-cell *matCellDef="let element"> {{element?.resignation_date | date}} </td>
          </ng-container>
          <ng-container matColumnDef="last_working_day">
              <th mat-header-cell *matHeaderCellDef> Last Working Day </th>
              <td mat-cell *matCellDef="let element"> {{element?.last_working_day | date}} </td>
          </ng-container>
          <ng-container matColumnDef="notice_period">
              <th mat-header-cell *matHeaderCellDef> Notice Period </th>
              <td mat-cell *matCellDef="let element"> {{element?.notice_period}} </td>
          </ng-container>
          <ng-container matColumnDef="resignation_reason">
              <th mat-header-cell *matHeaderCellDef> Resignation Reason </th>
              <td mat-cell *matCellDef="let element"> {{element?.resignation_reason}} </td>
          </ng-container>
          <ng-container matColumnDef="exit_interview_date">
              <th mat-header-cell *matHeaderCellDef> Exit Interview Date </th>
              <td mat-cell *matCellDef="let element"> {{element?.exit_interview_date | date}} </td>
          </ng-container>
          <ng-container matColumnDef="handover_complete">
              <th mat-header-cell *matHeaderCellDef> Handover Complete </th>
              <td mat-cell *matCellDef="let element"> {{element?.handover_complete ? 'Yes' : 'No'}} </td>
          </ng-container>
          <ng-container matColumnDef="company_property_returned">
              <th mat-header-cell *matHeaderCellDef> Company Property Returned </th>
              <td mat-cell *matCellDef="let element"> {{element?.company_property_returned ? 'Yes' : 'No'}} </td>
          </ng-container>
          <ng-container matColumnDef="final_pay_processed">
              <th mat-header-cell *matHeaderCellDef> Final Pay Processed </th>
              <td mat-cell *matCellDef="let element"> {{element?.final_pay_processed ? 'Yes' : 'No'}} </td>
          </ng-container>
          <ng-container matColumnDef="exit_feedback">
              <th mat-header-cell *matHeaderCellDef> Exit Feedback </th>
              <td mat-cell *matCellDef="let element"> {{element?.exit_feedback}} </td>
          </ng-container>
          <ng-container matColumnDef="resignation_status">
              <th mat-header-cell *matHeaderCellDef> Resignation Status </th>
              <td mat-cell *matCellDef="let element"> {{element?.resignation_status}} </td>
          </ng-container>
          <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef> Actions </th>
              <td mat-cell *matCellDef="let element">
                  <button mat-icon-button [matMenuTriggerFor]="menu">
                      <mat-icon>more_vert</mat-icon>
                  </button>
                  <mat-menu #menu="matMenu">
                      <button mat-menu-item *ngIf="element.resignation_status== resignationStatuses.Completed" (click)="selectedRecord = element;isEditMode = true; openDialog(element)">
                          <mat-icon>edit</mat-icon>
                          <span>Edit</span>
                      </button>
                      <button mat-menu-item *ngIf="element.resignation_status== resignationStatuses.Completed" (click)="selectedRecord = element; deleteDialog(element._id)">
                          <mat-icon>delete</mat-icon>
                          <span>Delete</span>
                      </button>
                  </mat-menu>
              </td>
          </ng-container> -->

          <!-- Header and Row Declarations -->
          <!-- <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table> -->
    }
    @else {
        <hrm-table
            [data]="allResignations" 
            [columns]="adminColumns" 
            (actionClicked)="onActionClick($event)" 
            [isServerSide]="false"
            [showSearch]="true" 
            [totalItems]="totalRecords" 
            [pageSize]="recordsPerPage" 
            (pageChanged)="onPageChange($event)"
            (searchChanged)="onSearchChange($event)">
        </hrm-table>

        <!--<table mat-table [dataSource]="allResignations" class="mt-3 mat-elevation-z8">
          <ng-container matColumnDef="user">
              <th mat-header-cell *matHeaderCellDef> User </th>
              <td mat-cell *matCellDef="let element"> {{getMatchingUser(element.user)}} </td>
          </ng-container>
          <ng-container matColumnDef="resignation_date">
              <th mat-header-cell *matHeaderCellDef> Resignation Date </th>
              <td mat-cell *matCellDef="let element"> {{element.resignation_date | date}} </td>
          </ng-container>
          <ng-container matColumnDef="last_working_day">
              <th mat-header-cell *matHeaderCellDef> Last Working Day </th>
              <td mat-cell *matCellDef="let element"> {{element.last_working_day | date}} </td>
          </ng-container>
          <ng-container matColumnDef="notice_period">
              <th mat-header-cell *matHeaderCellDef> Notice Period </th>
              <td mat-cell *matCellDef="let element"> {{element.notice_period}} </td>
          </ng-container>
          <ng-container matColumnDef="resignation_reason">
              <th mat-header-cell *matHeaderCellDef> Resignation Reason </th>
              <td mat-cell *matCellDef="let element"> {{element.resignation_reason}} </td>
          </ng-container>
          <ng-container matColumnDef="exit_interview_date">
              <th mat-header-cell *matHeaderCellDef> Exit Interview Date </th>
              <td mat-cell *matCellDef="let element"> {{element.exit_interview_date | date}} </td>
          </ng-container>
          <ng-container matColumnDef="handover_complete">
              <th mat-header-cell *matHeaderCellDef> Handover Complete </th>
              <td mat-cell *matCellDef="let element"> {{element.handover_complete ? 'Yes' : 'No'}} </td>
          </ng-container>
          <ng-container matColumnDef="company_property_returned">
              <th mat-header-cell *matHeaderCellDef> Company Property Returned </th>
              <td mat-cell *matCellDef="let element"> {{element.company_property_returned ? 'Yes' : 'No'}} </td>
          </ng-container>
          <ng-container matColumnDef="final_pay_processed">
              <th mat-header-cell *matHeaderCellDef> Final Pay Processed </th>
              <td mat-cell *matCellDef="let element"> {{element.final_pay_processed ? 'Yes' : 'No'}} </td>
          </ng-container>
          <ng-container matColumnDef="exit_feedback">
              <th mat-header-cell *matHeaderCellDef> Exit Feedback </th>
              <td mat-cell *matCellDef="let element"> {{element.exit_feedback}} </td>
          </ng-container>
          <ng-container matColumnDef="resignation_status">
              <th mat-header-cell *matHeaderCellDef> Resignation Status </th>
              <td mat-cell *matCellDef="let element"> {{element.resignation_status | titlecase}} </td>
          </ng-container>
          <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef> Actions </th>
              <td mat-cell *matCellDef="let element">
                  <button mat-icon-button [matMenuTriggerFor]="menu">
                      <mat-icon>more_vert</mat-icon>
                  </button>
                  <mat-menu #menu="matMenu">
                      <button mat-menu-item *ngIf="element.resignation_status !== resignationStatuses.Completed"
                          (click)="selectedStatus = element._id; changedStatus = resignationStatuses.Completed; openUpdateStatusDialog()">
                          <mat-icon>check_circle</mat-icon>
                          <span>Completed</span>
                      </button>
                      <button mat-menu-item *ngIf="element.resignation_status !== resignationStatuses.InProgress"
                          (click)="selectedStatus = element._id; changedStatus = resignationStatuses.InProgress; openUpdateStatusDialog()">
                          <mat-icon>hourglass_empty</mat-icon>
                          <span>In-Progress</span>
                      </button>
                      <button mat-menu-item *ngIf="element.resignation_status !== resignationStatuses.Approved"
                          (click)="selectedStatus = element._id; changedStatus = resignationStatuses.Approved; openUpdateStatusDialog()">
                          <mat-icon>done</mat-icon>
                          <span>Approved</span>
                      </button>
                  </mat-menu>
              </td>
          </ng-container> -->

          <!-- Header and Row Declarations -->
          <!--<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table> -->
    }

</div>

<ng-template #dialogTemplate>
  <div class="d-flex align-items-center justify-content-between">
    <h1 mat-dialog-title>{{isEditMode ? 'Update' : 'Create'}} Resignation</h1>
    <button type="button" mat-icon-button mat-dialog-close (click)="closeDialog()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>
    <form [formGroup]="resignationForm" (ngSubmit)="onSubmit()">
      <div class="row d-flex justify-content-center">
        <div class="row">
          <div class="col-md-6 mt-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Resignation Date</mat-label>
              <input matInput 
              [matDatepicker]="picker1" 
              formControlName="resignation_date" 
              [min]="minDate" 
              required>            
              <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
              <mat-datepicker #picker1></mat-datepicker>
              <mat-error *ngIf="resignationForm.controls['resignation_date'].hasError('required') && resignationForm.controls['resignation_date'].touched">
                Resignation Date is required.
              </mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Notice Period</mat-label>
              <input matInput type="number" formControlName="notice_period" [disabled]="!isEditMode" required>
              <mat-error *ngIf="resignationForm.controls['notice_period'].hasError('required') && resignationForm.controls['notice_period'].touched">
                Notice Period is required.
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <div class="row mt-3">
          
          <div class="col-md-6 mt-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Last Working Day</mat-label>
              <input matInput [matDatepicker]="picker2" formControlName="last_working_day" [min]="minDate"  required >
              <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
              <mat-datepicker #picker2></mat-datepicker>
              <mat-error *ngIf="resignationForm.controls['last_working_day'].hasError('required') && resignationForm.controls['last_working_day'].touched">
                Last Working Day is required.
              </mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Exit Interview Date</mat-label>
              <input matInput [matDatepicker]="picker3" formControlName="exit_interview_date" [min]="minDate" >
              <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
              <mat-datepicker #picker3></mat-datepicker>
            </mat-form-field>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col-12">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Resignation Reason</mat-label>
              <textarea matInput formControlName="resignation_reason" required></textarea>
              <mat-error *ngIf="resignationForm.controls['resignation_reason'].hasError('required') && resignationForm.controls['resignation_reason'].touched">
                Resignation Reason is required.
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col-12 d-flex justify-content-between">
            <mat-checkbox formControlName="handover_complete">Handover Complete</mat-checkbox>
            <mat-checkbox formControlName="company_property_returned">Company Property Returned</mat-checkbox>
            <mat-checkbox formControlName="final_pay_processed">Final Pay Processed</mat-checkbox>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col-12">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Exit Feedback</mat-label>
              <textarea matInput formControlName="exit_feedback"></textarea>
            </mat-form-field>
          </div>
        </div>
      </div>

      <div class="mt-2 d-flex justify-content-between" mat-dialog-actions>
        <button mat-flat-button class="mx-2" type="button" mat-dialog-close (click)="isEditMode ? closeDialog() : resetForm()">
          Cancel
        </button>
        <button mat-flat-button color="primary" type="submit" [disabled]="resignationForm.invalid">
          {{isEditMode ? 'Update' : 'Create'}} Resignation
        </button>
      </div>
    </form>
  </mat-dialog-content>
</ng-template>

<ng-template #updateStatusResignation>
  <div class="d-flex align-items-center justify-content-between">
    <h1 mat-dialog-title>Confirm Status Change</h1>
    <button type="button" mat-icon-button mat-dialog-close (click)="closeDialog()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>
    <p>Are you sure you want to mark the selected resignation request as '{{changedStatus | titlecase}}'?</p>
  </mat-dialog-content>

  <div class="mt-2 d-flex justify-content-end" mat-dialog-actions>
    <button mat-flat-button type="button" (click)="closeDialog()">No</button>
    <button mat-flat-button color="primary" type="submit" class="ms-3"
      (click)="updateResignationStatus(selectedStatus, changedStatus)">Yes</button>
  </div>
</ng-template>

<!-- <ng-template #dialogTemplate>
    <div class="p-3">
        <h2 mat-dialog-title class="d-flex justify-content-between">
            {{isEditMode ? 'Update' : 'Create'}} Resignation
            <button mat-icon-button (click)="closeDialog()">
                <mat-icon>close</mat-icon>
            </button>
        </h2>
        <form [formGroup]="resignationForm" (ngSubmit)="onSubmit()">
            <div class="row">

                <mat-form-field appearance="outline" class="col-md-6">
                    <input matInput [matDatepicker]="picker1" placeholder="Resignation Date"
                        formControlName="resignation_date">
                    <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                    <mat-datepicker #picker1></mat-datepicker>
                </mat-form-field>
                <mat-form-field appearance="outline" class="col-md-6">
                    <input matInput [matDatepicker]="picker2" placeholder="Last Working Day"
                        formControlName="last_working_day">
                    <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                    <mat-datepicker #picker2></mat-datepicker>
                </mat-form-field>
            </div>

            <div class="row">
                <mat-form-field appearance="outline" class="col-md-6">
                    <input matInput placeholder="Notice Period" formControlName="notice_period" type="number">
                </mat-form-field>
                <mat-form-field appearance="outline" class="col-md-6">
                    <input matInput [matDatepicker]="picker3" placeholder="Exit Interview Date"
                        formControlName="exit_interview_date">
                    <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
                    <mat-datepicker #picker3></mat-datepicker>
                </mat-form-field>
            </div>
            <div class="row">
                <mat-form-field appearance="outline" class="">
                    <textarea matInput placeholder="Resignation Reason" formControlName="resignation_reason"></textarea>
                </mat-form-field>

            </div>

            <div class="d-flex justify-content-between">
                <mat-checkbox formControlName="handover_complete">Handover Complete</mat-checkbox>
                <mat-checkbox formControlName="company_property_returned">Company Property Returned</mat-checkbox>
                <mat-checkbox formControlName="final_pay_processed">Final Pay Processed</mat-checkbox>
            </div>
            <div class="row">
                <mat-form-field appearance="outline" class="">
                    <textarea matInput placeholder="Exit Feedback" formControlName="exit_feedback"></textarea>
                </mat-form-field>
            </div>

            <div class="d-flex justify-content-between">
                <button mat-flat-button type="button" (click)="resetForm()">Reset</button>
                <button mat-flat-button type="submit">{{isEditMode ? 'Update' : 'Submit'}}</button>
            </div>
        </form>
    </div>
</ng-template>

<ng-template #updateStatusResignation>
    <div class="p-3">
        <h2 mat-dialog-title class="d-flex justify-content-between">
            Are you sure you want to mark the selected resignation request as '{{changedStatus | titlecase}}'?

        </h2>
        <div class="d-flex justify-content-end">
            <button mat-flat-button (click)="closeDialog()" type="button">No</button>
            <button mat-flat-button color="primary" type="submit" class="ms-3"
                (click)="updateResignationStatus(selectedStatus, changedStatus)">Yes</button>
        </div>
    </div>
</ng-template> -->