<div class="row py-2">
  <div class="col-auto">
    <mat-form-field appearance="outline" class="w-100">
      <mat-label>{{ 'reports.timesheet.select_user' | translate }}</mat-label>
      <mat-select name="users" multiple [(ngModel)]="selectedUser">
        <mat-slide-toggle class="m-2" (click)="selectAllUsers()" color="primary">{{ 'reports.timesheet.all' | translate }}</mat-slide-toggle>
        <hr class="my-0" />
        <mat-option *ngFor="let member of members" [value]="member.id" (click)="filterData()">
          {{member?.name | titlecase}}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div class="col-auto">
    <mat-form-field appearance="outline">
      <mat-label>{{ 'reports.timesheet.date_range' | translate }}</mat-label>
      <mat-date-range-input [rangePicker]="picker">
        <input matStartDate name="fromDate" id="fromDate" [(ngModel)]="fromDate" (ngModelChange)="filterData()"
               [formControl]="fromDateControl" placeholder="{{ 'reports.timesheet.start_date' | translate }}">
        <input matEndDate name="toDate" id="toDate" [(ngModel)]="toDate" (ngModelChange)="filterData()"
               [formControl]="toDateControl" placeholder="{{ 'reports.timesheet.end_date' | translate }}">
      </mat-date-range-input>
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-date-range-picker #picker></mat-date-range-picker>
      <mat-error *ngIf="fromDateControl.invalid && (fromDateControl.dirty || fromDateControl.touched)">
        {{ 'reports.timesheet.invalid_start_date' | translate }}
      </mat-error>
      <mat-error *ngIf="toDateControl.invalid && (toDateControl.dirty || toDateControl.touched)">
        {{ 'reports.timesheet.invalid_end_date' | translate }}
      </mat-error>
    </mat-form-field>
  </div>

  <div class="col-auto">
    <div class="dropdown">
      <button mat-icon-button matTooltip="{{ 'reports.timesheet.download' | translate }}" matTooltipPosition="below"
              class="me-2" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
        <mat-icon>download</mat-icon>
      </button>
      <ul class="dropdown-menu p-0" aria-labelledby="dropdownMenuButton1" id="dropdown-export">
        <li><a class="export-button" (click)="exportToCsv()">{{ 'reports.timesheet.csv' | translate }}</a></li>
        <li><a class="export-button" (click)="exportToXlsx()">{{ 'reports.timesheet.xls' | translate }}</a></li>
        <li><a class="export-button" (click)="exportToPdf()">{{ 'reports.timesheet.pdf' | translate }}</a></li>
      </ul>
    </div>
  </div>
</div>

<div class="table-wrapper border-start border-end" style="overflow-x: auto;">
  <table class="table table-bordered table-hover" id="adminTimeSheet" #adminTimeSheet style="min-width: max-content;">
    <thead>
      <tr>
        <th class="ps-2 sticky-col">{{ 'reports.timesheet.user' | translate }}</th>
        <th class="sticky-col-2">{{ 'reports.timesheet.project' | translate }}</th>
        <th class="pe-lg-2 pe-4 text-center" *ngFor="let date of timeLogs?.columns | slice:2">
          {{ date | date: 'MMM d' }}
        </th>
        <th class="pe-lg-2 pe-4 text-center">{{ 'reports.timesheet.total' | translate }}</th>
      </tr>
    </thead>

    <tbody>
      <ng-container *ngFor="let user of selectedUser">
        <tr *ngFor="let row of timeLogs?.matrix[user]; index as i">
          <td class="pe-5 sticky-col">{{ i == 0 ? getUserName(user) : '' }}</td>
          <td class="pe-4 sticky-col-2">{{ getProjectName(row[0]) }}</td>
          <td class="pe-lg-1 pe-4 text-center" *ngFor="let cell of row | slice:1">
            {{ +cell | milliSecondsToTime }}
          </td>
          <td class="pe-lg-1 pe-4 text-center">
            {{ getTotalHours(row.slice(1)) | milliSecondsToTime }}
          </td>
        </tr>

        <tr class="table-active total-row-background bold-text" *ngIf="timeLogs?.matrix[user]?.length > 0">
          <td class="sticky-col">{{ 'reports.timesheet.total' | translate }}</td>
          <td class="sticky-col-2"></td>
          <td class="pe-lg-1 pe-4 text-center" *ngFor="let row of timesheetAllTotals[user]">
            {{ row | milliSecondsToTime }}
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>
</div>
