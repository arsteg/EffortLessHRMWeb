<div class="row py-2">
  <div class="col-auto">
    <mat-form-field appearance="outline">
      <mat-label>{{ 'reports.timesheet.date_range' | translate }}</mat-label>
      <mat-date-range-input [rangePicker]="picker">
        <input matStartDate name="fromDate" id="fromDate" [(ngModel)]="fromDate" (ngModelChange)="filterData()"
          [formControl]="fromDateControl" placeholder="Start date">
        <input matEndDate name="toDate" id="toDate" [(ngModel)]="toDate" (ngModelChange)="filterData()"
          [formControl]="toDateControl" placeholder="End date">
      </mat-date-range-input>
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-date-range-picker #picker></mat-date-range-picker>
      <mat-error *ngIf="fromDateControl.invalid && (fromDateControl.dirty || fromDateControl.touched)">
        Invalid start date
      </mat-error>
      <mat-error *ngIf="toDateControl.invalid && (toDateControl.dirty || toDateControl.touched)">
        Invalid end date
      </mat-error>
    </mat-form-field>
  </div>

  <div class="col-auto">
    <div class="dropdown">
      <button mat-icon-button matTooltip="Download" matTooltipPosition="below"
          class="me-2" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
          <mat-icon>download</mat-icon>
      </button>
      <ul class="dropdown-menu p-0" aria-labelledby="dropdownMenuButton1" id="dropdown-export">
        <li><a class="export-button" (click)="exportToCsv()">{{ 'reports.timesheet.csv' | translate }}</a></li>
        <li><a class="export-button" (click)="exportToXlsx()">{{ 'reports.timesheet.xls' | translate }}</a></li>
        <li><a class="export-button" (click)="exportToPdf()">{{ 'reports.timesheet.pdf' | translate }}</a></li>
      </ul>
    </div>
  </div>
</div>

<div class="table-wrapper border-start border-end" style="overflow-x: auto;">
  <table class="table table-bordered table-hover" id="userTimeSheet" #userTimeSheet style="min-width: max-content;">
    <thead>
      <tr>
        <th class="ps-2 sticky-col">{{ 'reports.timesheet.project' | translate }}</th>
        <th class="pe-lg-2 pe-4 text-center" *ngFor="let date of timeLogs?.columns|slice:1">{{ date | date: 'MMM d' }}</th>
        <th class="pe-lg-2 pe-4 text-center">{{ 'reports.timesheet.total' | translate }}</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let row of timeLogs?.matrix">
        <td class="pe-4 sticky-col">{{ getProjectName(row[0]) }}</td>
        <td class="pe-lg-1 pe-4 text-center" *ngFor="let cell of row|slice:1">{{+cell | milliSecondsToTime}}</td>
        <td class="pe-lg-1 pe-4 text-center">{{getTotalHours(row.slice(1)) | milliSecondsToTime}}</td>
      </tr>
      
      <tr class="table-active total-row-background bold-text" *ngIf="this.timeLogs?.matrix.length>0">
        <td class="sticky-col">Total</td>
        <td class="pe-lg-1 pe-4 text-center" *ngFor="let cell of timesheetTotals|slice:1">{{+cell | milliSecondsToTime}}</td>
        <td class="pe-lg-1 pe-4 text-center">{{getTotalHours(timesheetTotals)|milliSecondsToTime}}</td>
      </tr>
    </tbody>
  </table>
</div>
