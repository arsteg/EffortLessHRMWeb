<div class="mt-2 px-2">
  <form [formGroup]="variableAllowanceForm">
    <table mat-table class="hrm-table" [dataSource]="allowances">
      <ng-container matColumnDef="category">
        <th mat-header-cell *matHeaderCellDef> Category </th>
        <td mat-cell *matCellDef="let allowance"> {{ allowance.get('variableAllowanceLabel').value }} </td>
      </ng-container>

      <ng-container matColumnDef="criteria">
        <th mat-header-cell *matHeaderCellDef> Criteria </th>
        <td mat-cell *matCellDef="let allowance" [formGroup]="allowance">
          <mat-form-field>
            <mat-select formControlName="criteria" [disabled]="true">
              <mat-option value="Amount">Amount</mat-option>
            </mat-select>
          </mat-form-field>
        </td>
      </ng-container>

      <ng-container matColumnDef="value">
        <th mat-header-cell *matHeaderCellDef> Value </th>
        <td mat-cell *matCellDef="let allowance" [formGroup]="allowance">
          <ng-container [ngSwitch]="allowance.get('criteria').value">
            <mat-form-field *ngSwitchCase="'Amount'">
              <input matInput type="number" min="0" formControlName="value" placeholder="Enter Amount" (input)="allowance.markAsTouched()">
              <mat-error *ngIf="allowance.get('value').hasError('required') && allowance.get('value').touched">
                {{ 'payroll.field_required' | translate }}
              </mat-error>
              <mat-error *ngIf="allowance.get('value').hasError('min') && allowance.get('value').touched">
                Value cannot be negative
              </mat-error>
            </mat-form-field>
            <mat-form-field *ngSwitchCase="'Percentage'">
              <input matInput type="number" min="0" formControlName="value" placeholder="Enter Percentage" (input)="allowance.markAsTouched()">
              <mat-error *ngIf="allowance.get('value').hasError('required') && allowance.get('value').touched">
                {{ 'payroll.field_required' | translate }}
              </mat-error>
              <mat-error *ngIf="allowance.get('value').hasError('min') && allowance.get('value').touched">
                Percentage cannot be negative
              </mat-error>
            </mat-form-field>
          </ng-container>
        </td>
      </ng-container>

     <ng-container matColumnDef="minimumAmount">
        <th mat-header-cell *matHeaderCellDef> Minimum Amount </th>
        <td mat-cell *matCellDef="let allowance" [formGroup]="allowance">
          <mat-form-field>
            <input matInput type="number" min="0" formControlName="minimumAmount"  placeholder="Enter Minimum Amount">
            <mat-error *ngIf="allowance.get('minimumAmount').hasError('required') && allowance.get('minimumAmount').touched">
              {{ 'payroll.field_required' | translate }}
            </mat-error>
            <mat-error *ngIf="allowance.get('minimumAmount').hasError('min') && allowance.get('minimumAmount').touched">
              {{ 'payroll._ctc_templates.minimum_amount_positive_only' | translate }}  
            </mat-error>
            <mat-error *ngIf="allowance.get('minimumAmount').hasError('min')">Minimum Amount cannot be negative</mat-error>
         </mat-form-field>
         <mat-error *ngIf="allowance.hasError('minGreaterThanValue')">
          {{ 'payroll._ctc_templates.minimum_amount_greater_than_value' | translate }}  
        </mat-error>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['category', 'criteria', 'value', 'minimumAmount']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['category', 'criteria', 'value', 'minimumAmount']"></tr>
    </table>
  </form>
</div>