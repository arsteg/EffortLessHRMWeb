<div class="modal-header border-bottom mb-2 pt-0 d-flex justify-content-between">
    <div>
        <h1 class="modal-title text-muted mb-0" *ngIf="changeMode === 'Next'">{{ 'leave.createTemplate.updateTemplateTitle' | translate }}</h1>
        <h1 class="modal-title text-muted mb-0" *ngIf="changeMode === 'Add'">{{ 'leave.createTemplate.addTemplateTitle' | translate }}</h1>
    </div>
    <div>
        <button type="button" data-bs-dismiss="modal" class="btn-close text-end" (click)="closeModal()"
                [attr.aria-label]="'leave.createTemplate.closeModal' | translate"></button>
    </div>
</div>

<form [formGroup]="addTemplateForm" (ngSubmit)="onSubmission()">
    <div class="form-group">
        <label for="label">{{ 'leave.createTemplate.label' | translate }}<span class="text-danger">*</span></label>
        <input type="text" class="input form-control" [placeholder]="'leave.createTemplate.labelPlaceholder' | translate"
               formControlName="label" id="label" required>
        <div *ngIf="addTemplateForm.get('label')?.invalid && addTemplateForm.get('label')?.touched"
             class="text-danger error">
            {{ 'leave.createTemplate.errorLabelRequired' | translate }}
        </div>
    </div>

    <div class="form-group mt-2">
        <label for="approvalLevel">{{ 'leave.createTemplate.approvalLevel' | translate }}<span class="text-danger">*</span></label>
        <div class="d-flex">
            <div class="form-check">
                <input class="form-check-input" type="radio" id="level" formControlName="approvalLevel" value="1-level"
                       required>
                <label class="form-check-label" for="level">
                    {{ 'leave.createTemplate.oneLevel' | translate }}
                </label>
            </div>
            <div class="form-check ms-4">
                <input class="form-check-input" type="radio" id="level2" formControlName="approvalLevel" value="2-level"
                       required>
                <label class="form-check-label" for="level2">
                    {{ 'leave.createTemplate.twoLevel' | translate }}
                </label>
            </div>
        </div>
        <div *ngIf="addTemplateForm.get('approvalLevel')?.invalid && addTemplateForm.get('approvalLevel')?.touched"
             class="text-danger error">
            {{ 'leave.createTemplate.errorApprovalLevelRequired' | translate }}
        </div>
    </div>

    <div class="mt-2 form-group">
        <label for="approvalType">{{ 'leave.createTemplate.approvalType' | translate }}<span class="text-danger">*</span></label>
        <div class="d-flex">
            <div class="form-check">
                <input class="form-check-input" type="radio" id="template-wise" formControlName="approvalType"
                       value="template-wise" required>
                <label class="form-check-label" for="template-wise">
                    {{ 'leave.createTemplate.templateWise' | translate }}
                </label>
            </div>
            <div class="form-check ms-4">
                <input class="form-check-input" type="radio" id="employee-wise" formControlName="approvalType"
                       value="employee-wise" required>
                <label class="form-check-label" for="employee-wise">
                    {{ 'leave.createTemplate.employeeWise' | translate }}
                </label>
            </div>
        </div>
        <div *ngIf="addTemplateForm.get('approvalType')?.invalid && addTemplateForm.get('approvalType')?.touched"
             class="text-danger error">
            {{ 'leave.createTemplate.errorApprovalTypeRequired' | translate }}
        </div>
    </div>

    <div class="row mt-2" *ngIf="addTemplateForm.get('approvalType')?.value === 'template-wise'">
        <div class="col-md-6">
            <label for="primaryApprover">{{ 'leave.createTemplate.primaryApprover' | translate }}<span class="text-danger">*</span></label>
            <select id="primaryApprover" formControlName="primaryApprover" required class="ms-2 form-control">
                <option disabled value="">{{ 'leave.createTemplate.selectPrimaryApprover' | translate }}</option>
                <option [value]="user?.id" *ngFor="let user of users; let i = index">
                    {{ getUserName(user?.id) | titlecase }}
                </option>
            </select>
            <div *ngIf="addTemplateForm.get('primaryApprover')?.invalid && addTemplateForm.get('primaryApprover')?.touched"
                 class="text-danger error">
                {{ 'leave.createTemplate.errorPrimaryApproverRequired' | translate }}
            </div>
        </div>

        <div class="col-md-6" *ngIf="addTemplateForm.get('approvalLevel')?.value === '2-level'">
            <label for="secondaryApprover">{{ 'leave.createTemplate.secondaryApprover' | translate }}<span class="text-danger">*</span></label>
            <select id="secondaryApprover" formControlName="secondaryApprover" required class="ms-2 form-control">
                <option disabled value="">{{ 'leave.createTemplate.selectSecondaryApprover' | translate }}</option>
                <option [value]="user?.id" *ngFor="let user of users; let i = index">
                    {{ getUserName(user?.id) | titlecase }}
                </option>
            </select>
            <div *ngIf="addTemplateForm.get('secondaryApprover')?.invalid && addTemplateForm.get('secondaryApprover')?.touched"
                 class="text-danger error">
                {{ 'leave.createTemplate.errorSecondaryApproverRequired' | translate }}
            </div>
        </div>
    </div>

    <div class="form-group mt-2">
        <label for="isCommentMandatory">{{ 'leave.createTemplate.isCommentMandatory' | translate }}<span class="text-danger">*</span></label>
        <div class="d-flex">
            <div class="form-check">
                <input class="form-check-input" type="radio" id="isCommentMandatory-yes"
                       formControlName="isCommentMandatory" [value]="true" required>
                <label class="form-check-label" for="isCommentMandatory-yes">
                    {{ 'leave.createTemplate.yes' | translate }}
                </label>
            </div>
            <div class="form-check ms-4">
                <input class="form-check-input" type="radio" id="isCommentMandatory-no"
                       formControlName="isCommentMandatory" [value]="false" required>
                <label class="form-check-label" for="isCommentMandatory-no">
                    {{ 'leave.createTemplate.no' | translate }}
                </label>
            </div>
        </div>
        <div *ngIf="addTemplateForm.get('isCommentMandatory')?.invalid && addTemplateForm.get('isCommentMandatory')?.touched"
             class="text-danger error">
            {{ 'leave.createTemplate.errorCommentMandatoryRequired' | translate }}
        </div>
    </div>

    <div class="mt-2 form-group">
        <mat-form-field appearance="outline" class="w-100">
            <mat-label>{{ 'leave.createTemplate.leaveCategories' | translate }}</mat-label>
            <mat-select multiple formControlName="leaveCategories">
                <mat-option [value]="category?._id" *ngFor="let category of categories; let i = index">
                    {{ category?.label }}
                </mat-option>
            </mat-select>
            <!-- <div *ngIf="addTemplateForm.get('leaveCategories')?.invalid && addTemplateForm.get('leaveCategories')?.touched"
                 class="text-danger error">
                {{ 'leave.createTemplate.errorLeaveCategoriesRequired' | translate }}
            </div> -->
        </mat-form-field>
    </div>

    <div class="form-group mt-2">
        <label for="clubbingRestrictions">{{ 'leave.createTemplate.clubbingRestrictions' | translate }}<span class="text-danger">*</span></label>
        <div class="d-flex">
            <div class="form-check">
                <input class="form-check-input" type="radio" id="club-yes" formControlName="clubbingRestrictions"
                       [value]="true" required>
                <label class="form-check-label" for="club-yes">
                    {{ 'leave.createTemplate.yes' | translate }}
                </label>
            </div>
            <div class="form-check ms-4">
                <input class="form-check-input" type="radio" id="club-no" formControlName="clubbingRestrictions"
                       [value]="false" required>
                <label class="form-check-label" for="club-no">
                    {{ 'leave.createTemplate.no' | translate }}
                </label>
            </div>
        </div>
        <div *ngIf="addTemplateForm.get('clubbingRestrictions')?.invalid && addTemplateForm.get('clubbingRestrictions')?.touched"
             class="text-danger error">
            {{ 'leave.createTemplate.errorClubbingRestrictionsRequired' | translate }}
        </div>
    </div>

    <div *ngIf="addTemplateForm.get('clubbingRestrictions')?.value === true">
        <button type="button" class="submenuTab active rounded-pill" (click)="addClubbedCategory()">
            {{ 'leave.createTemplate.addClubbingRestriction' | translate }}
        </button>

        <div class="mt-2" formArrayName="clubbingRestrictionCategories">
            <div class="row" *ngFor="let fieldGroup of clubbingRestrictionCategories.controls; let i = index">
                <ng-container [formGroupName]="i">
                    <mat-form-field appearance="outline" class="col-5">
                        <mat-label>{{ 'leave.createTemplate.category' | translate }}</mat-label>
                        <mat-select formControlName="leaveCategory">
                            <mat-option [value]="category?._id" *ngFor="let category of categories; let i = index">
                                {{ getCategoryLabel(category?._id) }}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="fieldGroup.get('leaveCategory')?.invalid && fieldGroup.get('leaveCategory')?.touched">
                            {{ 'leave.createTemplate.errorCategoryRequired' | translate }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="col-5">
                        <mat-label>{{ 'leave.createTemplate.restrictedClubbedCategory' | translate }}</mat-label>
                        <mat-select formControlName="restrictedClubbedLeaveCategory">
                            <mat-option [value]="category?._id" *ngFor="let category of categories; let i = index">
                                {{ getCategoryLabel(category?._id) }}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="fieldGroup.get('restrictedClubbedLeaveCategory')?.invalid && fieldGroup.get('restrictedClubbedLeaveCategory')?.touched">
                            {{ 'leave.createTemplate.errorRestrictedCategoryRequired' | translate }}
                        </mat-error>
                    </mat-form-field>
                </ng-container>
                <button class="actions ms-2 col-2" mat-mini-fab [matTooltip]="'leave.createTemplate.deleteCategory' | translate"
                        matTooltipPosition="after" type="button" [attr.aria-label]="'leave.createTemplate.deleteCategory' | translate"
                        (click)="removeCategory(i)">
                    <i class="bi bi-trash"></i>
                </button>
            </div>
        </div>

        <div class="form-group mt-2">
            <label for="weeklyOffClubTogether">{{ 'leave.createTemplate.weeklyOffClubTogether' | translate }}</label>
            <div class="d-flex">
                <div class="form-check">
                    <input class="form-check-input" type="radio" id="weeklyOff-yes"
                           formControlName="weeklyOffClubTogether" [value]="true" required>
                    <label class="form-check-label" for="weeklyOff-yes">
                        {{ 'leave.createTemplate.yes' | translate }}
                    </label>
                </div>
                <div class="form-check ms-4">
                    <input class="form-check-input" type="radio" id="weeklyOff-no"
                           formControlName="weeklyOffClubTogether" [value]="false" required>
                    <label class="form-check-label" for="weeklyOff-no">
                        {{ 'leave.createTemplate.no' | translate }}
                    </label>
                </div>
            </div>
        </div>

        <div class="form-group mt-2">
            <label for="holidayClubTogether">{{ 'leave.createTemplate.holidayClubTogether' | translate }}</label>
            <div class="d-flex">
                <div class="form-check">
                    <input class="form-check-input" type="radio" id="holiday-yes"
                           formControlName="holidayClubTogether" [value]="true" required>
                    <label class="form-check-label" for="holiday-yes">
                        {{ 'leave.createTemplate.yes' | translate }}
                    </label>
                </div>
                <div class="form-check ms-4">
                    <input class="form-check-input" type="radio" id="holiday-no"
                           formControlName="holidayClubTogether" [value]="false" required>
                    <label class="form-check-label" for="holiday-no">
                        {{ 'leave.createTemplate.no' | translate }}
                    </label>
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex border-top py-2 justify-content-between">
        <button mat-flat-button type="button" (click)="closeModal()">{{ 'leave.createTemplate.cancel' | translate }}</button>
        <button mat-flat-button class="addBtn" type="submit">{{ changeMode === 'Add' ? ('leave.createTemplate.update' | translate) : ('leave.createTemplate.update' | translate) }}</button>
    </div>
</form>