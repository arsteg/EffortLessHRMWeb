<div class="main-content">
    <div class="container-fluid">
        <div class="py-2 px-0 bg-white tableContainer">
            <div class="d-flex justify-content-between align-items-center mb-2 px-3">
                <p class="mb-0">({{tableService.totalRecords}}) {{ 'leave.recordsFound' | translate }}</p>
                <div class="d-flex align-items-center">
                    <span class="bi bi-search searchIcon"></span>
                    <input class="form-control search" type="text" [placeholder]="'leave.searchPlaceholder' | translate"
                        [(ngModel)]="tableService.searchText" (input)="tableService.applyFilter()" name="searchText"
                        aria-label="default input example">
                    <button mat-flat-button (click)="isEdit = false; changeMode='Add'; open(addModal);"
                        class="addBtn rounded-pill mx-3">{{ 'leave.addButton' | translate }}</button>
                </div>
            </div>
            <table mat-table [dataSource]="tableService.dataSource" class="p-2 rounded mt-2">
                <ng-container matColumnDef="label">
                    <th mat-header-cell *matHeaderCellDef>
                        {{ 'leave.leaveLabel' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let leaveTemp"> {{ leaveTemp?.label }} </td>
                </ng-container>
                <ng-container matColumnDef="numberOfEmployeesCovered">
                    <th mat-header-cell *matHeaderCellDef class="text-center">
                        {{ 'leave.numberOfEmployeesCovered' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let leaveTemp" class="text-center"> {{ calculateTotalEmployees(leaveTemp)
                        }} </td>
                </ng-container>
                <ng-container matColumnDef="numberOfLeaveCategories">
                    <th mat-header-cell *matHeaderCellDef class="text-center">
                        {{ 'leave.numberOfLeaveCategories' | translate }}
                    </th>
                    <td mat-cell *matCellDef="let leaveTemp" class="text-center"> {{
                        leaveTemp?.applicableCategories?.length || 0 }} </td>
                </ng-container>
                <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef> {{ 'leave.action' | translate }} </th>
                    <td mat-cell *matCellDef="let leaveTemp">
                        <button class="actions" mat-mini-fab [matTooltip]="'leave.editTooltip' | translate"
                            matTooltipPosition="before" aria-label="{{ 'leave.editTooltip' | translate }}"
                            (click)="changeMode='Next'; isEdit = true; selectedTemplate= leaveTemp; setFormValues(leaveTemp); open(addModal);">
                            <i class="bi bi-pencil-fill"></i>
                        </button>
                        <button class="actions ms-2" mat-mini-fab [matTooltip]="'leave.deleteTooltip' | translate"
                            matTooltipPosition="after" aria-label="{{ 'leave.deleteTooltip' | translate }}"
                            (click)="deleteDialog(leaveTemp?._id)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
            <mat-paginator [length]="tableService.totalRecords" [pageSize]="tableService.recordsPerPage"
                [pageSizeOptions]="recordsPerPageOptions" (page)="onPageChange($event)">
            </mat-paginator>
        </div>
    </div>
</div>

<ng-template #addModal let-modal>
    <app-create-leave [changeMode]="changeMode" [selectedTemplate]="selectedTemplate"
        (changeStep)="onChangeStep($event)" (close)="onClose($event)" *ngIf="step == 1"
        [isEdit]="isEdit"></app-create-leave>
    <app-add-category-leave *ngIf="step == 2" [isEdit]="isEdit" (close)="onClose($event)"
        (changeStep)="onChangeStep($event)" [selectedTemplate]="selectedTemplate"
        (updateLeaveTemplateTable)="refreshLeaveTemplateTable()"></app-add-category-leave>
</ng-template>