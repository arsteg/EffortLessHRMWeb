<div class="main-content mt-2">
    <div class="tableContainer bg-white">
        <div class="d-flex justify-content-between align-items-center mb-2 pt-2 px-3">
            <p class="mb-0">({{tableService.totalRecords}}) {{ 'leave.recordsFound' | translate }}</p>
            <div class="d-flex align-items-center">
                <span class="bi bi-search searchIcon"></span>
                <input class="form-control search" type="text" [placeholder]="'leave.searchPlaceholder' | translate"
                    [(ngModel)]="tableService.searchText" (input)="tableService.applyFilter()" name="searchText"
                    aria-label="default input example">
                <button mat-raised-button (click)="open(addModal)" class="addBtn rounded-pill mx-3">
                    {{ 'leave.addButton' | translate }}
                </button>
            </div>
        </div>
        <table mat-table [dataSource]="tableService.dataSource" class="p-2 rounded mt-2">
            <ng-container matColumnDef="user">
                <th mat-header-cell *matHeaderCellDef>
                    {{ 'leave.employee' | translate }}
                </th>
                <td mat-cell *matCellDef="let tempAssignment"> {{ getUser(tempAssignment?.user) }} </td>
            </ng-container>
            <ng-container matColumnDef="leaveTemplate">
                <th mat-header-cell *matHeaderCellDef>
                    {{ 'leave.currentLeavePolicy' | translate }}
                </th>
                <td mat-cell *matCellDef="let tempAssignment"> {{ getTemplateLabel(tempAssignment?.leaveTemplate) }}
                </td>
            </ng-container>
            <ng-container matColumnDef="primaryApprover">
                <th mat-header-cell *matHeaderCellDef>
                    {{ 'leave.primarySupervisor' | translate }}
                </th>
                <td mat-cell *matCellDef="let tempAssignment"> {{ getUser(tempAssignment?.primaryApprover) }} </td>
            </ng-container>
            <ng-container matColumnDef="secondaryApprover">
                <th mat-header-cell *matHeaderCellDef>
                    {{ 'leave.secondarySupervisor' | translate }}
                </th>
                <td mat-cell *matCellDef="let tempAssignment"> {{ getUser(tempAssignment?.secondaryApprover) }} </td>
            </ng-container>
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef> {{ 'leave.action' | translate }} </th>
                <td mat-cell *matCellDef="let tempAssignment">
                    <button class="actions" mat-mini-fab [matTooltip]="'leave.editTooltip' | translate"
                        matTooltipPosition="before" aria-label="{{ 'leave.editTooltip' | translate }}"
                        (click)="open(addModal); selectedLeaveAssignment = tempAssignment; editTemplateAssignment(tempAssignment)">
                        <i class="bi bi-pencil-fill"></i>
                    </button>
                    <button class="actions ms-2" mat-mini-fab [matTooltip]="'leave.deleteTooltip' | translate"
                        matTooltipPosition="after" aria-label="{{ 'leave.deleteTooltip' | translate }}"
                        (click)="deleteDialog(tempAssignment?._id)">
                        <i class="bi bi-trash"></i>
                    </button>
                </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
        <mat-paginator [length]="tableService.totalRecords" [pageSize]="tableService.recordsPerPage"
            [pageSizeOptions]="recordsPerPageOptions" (page)="onPageChange($event)">
        </mat-paginator>
    </div>
</div>

<ng-template #addModal let-modal>
    <div class="modal-body">
        <div class="d-flex justify-content-between">
            <div>
                <h4 class="modal-title text-start">
                    {{ !isEdit ? ('leave.addLeaveTemplateAssignment' | translate) :
                    ('leave.updateLeaveTemplateAssignment' | translate) }}
                </h4>
            </div>
            <div>
                <button type="button" (click)="modal.dismiss('Cross click')" data-bs-dismiss="modal"
                    class="btn-close text-end"></button>
            </div>
        </div>
        <hr class="mt-0">
        <div>
            <form [formGroup]="templateAssignmentForm" (ngSubmit)="onSubmission()">
                <div class="form-group">
                    <label class="">{{ 'leave.chooseEmployee' | translate }} <span class="text-danger">*</span></label>
                    <select class="form-control" formControlName="user">
                        <option value="" disabled>{{ 'leave.select' | translate }}</option>
                        <option [value]="user?.id" *ngFor="let user of users" [user]="user">{{user?.firstName |
                            titlecase}} {{user?.lastName | titlecase}}</option>
                    </select>
                    <div *ngIf="templateAssignmentForm.get('user').invalid && templateAssignmentForm.get('user').touched"
                        class="text-danger error">
                        {{ 'leave.errorChooseEmployee' | translate }}
                    </div>
                </div>
                <div class="form-group mt-3">
                    <label class="">{{ 'leaveLabel' | translate }} <span class="text-danger">*</span></label>
                    <select class="form-control" formControlName="leaveTemplate">
                        <option value="" disabled>{{ 'leave.selectLabel' | translate }}</option>
                        <option [value]="temp?._id" *ngFor="let temp of templates">{{temp?.label}}</option>
                    </select>
                    <div *ngIf="templateAssignmentForm.get('leaveTemplate').invalid && templateAssignmentForm.get('leaveTemplate').touched"
                        class="text-danger error">
                        {{ 'leave.errorChooseTemplate' | translate }}
                    </div>
                </div>
                <div class="form-group mt-3" *ngIf="showApprovers">
                    <label class="">{{ 'leave.selectPrimaryApprover' | translate }} <span
                            class="text-danger">*</span></label>
                    <select class="form-control" formControlName="primaryApprover">
                        <option value="" disabled>{{ 'leave.select' | translate }}</option>
                        <option [value]="user?.id" *ngFor="let user of users" [user]="user">{{user?.firstName |
                            titlecase}} {{user?.lastName | titlecase}}</option>
                    </select>
                    <div *ngIf="templateAssignmentForm.get('primaryApprover').invalid && templateAssignmentForm.get('primaryApprover').touched"
                        class="text-danger error">
                        {{ 'leave.errorChoosePrimaryApprover' | translate }}
                    </div>
                </div>
                <div class="form-group mt-3" *ngIf="showApprovers">
                    <label class="">{{ 'leave.selectSecondaryApprover' | translate }} <span
                            class="text-danger">*</span></label>
                    <select class="form-control" formControlName="secondaryApprover">
                        <option value="" disabled>{{ 'leave.select' | translate }}</option>
                        <option [value]="user?.id" *ngFor="let user of users" [user]="user">{{user?.firstName |
                            titlecase}} {{user?.lastName | titlecase}}</option>
                    </select>
                    <div *ngIf="templateAssignmentForm.get('secondaryApprover').invalid && templateAssignmentForm.get('secondaryApprover').touched"
                        class="text-danger error">
                        {{ 'leave.errorChooseSecondaryApprover' | translate }}
                    </div>
                </div>
                <div class="modal-footer d-flex justify-content-between mt-4 pb-0">
                    <button mat-raised-button class="mx-2" (click)="resetForm(); modal.dismiss('Cancel click')"
                        type="reset">
                        {{ 'leave.cancelButton' | translate }}
                    </button>
                    <button mat-raised-button class="addBtn" type="submit" [disabled]="templateAssignmentForm.invalid">
                        {{ !isEdit ? ('leave.addButton' | translate) : ('leave.updateButton' | translate) }}
                    </button>
                </div>
            </form>
        </div>
    </div>
</ng-template>