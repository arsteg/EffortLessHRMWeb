<div class="d-flex align-items-center justify-content-between">
  <h1 mat-dialog-title>
    {{ 'helpdesk.create_title' | translate }}
  </h1>
  <button mat-icon-button mat-dialog-close="" class="me-4">
    <mat-icon>close</mat-icon>
  </button>
</div>

<div>
  <div mat-dialog-content>
      <div class="row m-0">
          <div class="form-group col-12 mb-3">
                <mat-form-field class="w-100">
                  <mat-label>{{ 'helpdesk.description_label' | translate }}</mat-label>
                  <textarea
                    matInput
                    id="description"
                    rows="3" maxlength="2000"
                    [(ngModel)]="description" minlength="1"
                    #descModel="ngModel"
                    required
                    placeholder="Enter your description here..."
                  ></textarea>
                  <mat-error *ngIf="descModel.invalid && descModel.touched">
                    {{ 'helpdesk.description_required' | translate }}
                  </mat-error>
                </mat-form-field>
          </div>

          <div class="col-12 mb-3">
              <button class="btn btn-outline-success me-2" *ngIf="!isRecording" tooltip="You can record a video of your screen to explain your issue better" (click)="startRecording()">
                  <i class="fas fa-video"></i> {{ 'helpdesk.start_recording' | translate }}
              </button>
              <button class="btn btn-danger me-2" *ngIf="isRecording" (click)="stopRecording()">
                  <i class="fas fa-stop"></i> {{ 'helpdesk.stop_recording' | translate }}
              </button>
              <div class="mb-3" *ngIf="recordedVideoUrl">
                  <h6>{{ 'helpdesk.recorded_video_preview' | translate }}</h6>
                  <video [src]="recordedVideoUrl" controls class="w-100" style="max-width: 700px;"></video>
                  <button class="btn btn-sm btn-danger mt-2" (click)="removeRecordedVideo()">{{ 'helpdesk.remove_video' | translate }}</button>
              </div>
          </div>

          <div class="col-12 mb-3">
              <mat-label>{{ 'helpdesk.upload_files_label' | translate }}</mat-label>
              <input
                  type="file"
                  class="form-control"
                  id="fileUpload"
                  multiple
                  accept="image/*,application/pdf,.doc,.docx,.xls,.xlsx,.txt"
                  (change)="onFileUpload($event)"
              />
          </div>

          <div class="col-12 mb-3" *ngIf="uploadedFiles?.length">
            <h6>{{ 'helpdesk.file_previews' | translate }}</h6>
            <div class="d-flex flex-wrap gap-2">
              <div *ngFor="let file of uploadedFiles" class="position-relative">
                <img
                  *ngIf="file.type.startsWith('image/')"
                  [src]="file.data"
                  class="img-thumbnail"
                  style="height: 100px;"
                />
                <div
                  *ngIf="!file.type.startsWith('image/')"
                  class="border p-2 rounded"
                  style="width: 150px;"
                >
                  <span>{{ file.name }}</span><br />
                  <small>{{ file.type }}</small>
                </div>
                <button mat-icon-button
                  class="btn btn-sm btn-danger position-absolute top-0 end-0"
                  (click)="removeFile(file)"
                >
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>
          </div>
      </div>
  </div>
  <div mat-dialog-actions class="d-flex align-items-center justify-content-between">
    <button mat-flat-button (click)="closeDialog()">{{ 'helpdesk.cancel' | translate }}</button>
    <button type="submit" [disabled]="isSubmitting" color="primary" mat-flat-button (click)="submitRequest()">{{ 'helpdesk.submit_request' | translate }}</button>
  </div>
</div>
