<div class="main-content pt-0">
  <div class="container-fluid">
    <div class="d-flex pt-4 w-50">
      <h1 class="">Timeline</h1>
      <div class="ms-5 ps-4 pt-2">
        <button class="buttons">Contract</button>
        <button class="buttons mx-3">Project</button>
        <button class="buttons">Members</button>
      </div>
    </div>
    <hr class="mt-0">
    <div class="d-flex mt-4">

      <span class="pt-3 text-muted me-3">Filter&nbsp;by: </span>
      <mat-form-field appearance="outline" class="w-25 mx-1" >
        <mat-label>Select User</mat-label>
        <mat-select multiple [(ngModel)]="selectedUser">
          <mat-option *ngFor="let member of members" [value]="member.id" (click)="filterData()"
            [selected]="selectedUser?.includes(member?.id)">
            {{member.name | titlecase}}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-25 mx-1">
        <mat-label>Select Project</mat-label>
        <mat-select multiple [(ngModel)]="selectedProject">
          <mat-option *ngFor="let project of projectList" [value]="project?.id" (click)="filterData()"
            [selected]="selectedProject?.includes(project?.id)">
            {{project?.projectName | titlecase}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div class="input-group date-style w-25">
        <span (click)="SetPreviousDay()" class="fa fa-angle-left fa-lg p-3"></span>
        <input type="date" name="fromDate" id="fromDate" (change)="filterData()" [(ngModel)]="selectedDate"
          class="form-control w-25 calendar mb-4 mx-1 " />
        <span (click)="SetNextDay()" class="fa fa-angle-right fa-lg p-3"></span>
      </div>
      <div class="align-items-start flex-wrap gap-3 ms-auto d-none" >
        <div class="dropdown order-first order-sm-last d-flex">
          <button class="export-btn dropdown-toggle formrow-inputState form-select select-styled active" type="button"
            id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
            <p class="mb-0 py-2 text-muted"> Export </p>
          </button>
          <ul class="dropdown-menu p-0" aria-labelledby="dropdownMenuButton1" id="dropdown-export">
            <li><a class="export-button" (click)="exportToCsv()">CSV</a></li>
            <li><a class="export-button" (click)="exportToExcel()">XLS</a></li>
            <li><a class="export-button" (click)="exportToPdf()">PDF</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="d-flex justify-content-between">
      <div class="col-sm-8 d-flex gap-3 color-bgs">
        <div class="mb-3 d-flex align-items-center gap-1">
          <label class="type-tracked">
            <input type="checkbox" checked="" value="tracked" (change)="toggleLogsVisibility('tracked')">
            <span class="type-tracked__control tracked"></span>
            <span class="type-tracked__label">Tracked</span>
          </label>
        </div>
        <div class="mb-3 d-flex align-items-center gap-1">
          <label class="type-tracked">
            <input type="checkbox" checked="" value="manual" (change)="toggleLogsVisibility('manual')">
            <span class="type-tracked__control manual"></span>
            <span class="type-tracked__label text-dark">Manual </span>
          </label>
        </div>
        <div class="mb-3 d-flex align-items-center gap-1">
          <label class="type-tracked">
            <input type="checkbox" checked="" value="medium" (change)="toggleLogsVisibility('medium')">
            <span class="type-tracked__control medium"></span>
            <span class="type-tracked__label text-dark">Medium Activity </span>
          </label>
        </div>
        <div class="mb-3 d-flex align-items-center gap-1">
          <label class="type-tracked">
            <input type="checkbox" checked="" value="low" (change)="toggleLogsVisibility('low')">
            <span class="type-tracked__control low"></span>
            <span class="type-tracked__label text-dark">Low Activity </span>
          </label>
        </div>
        <div class="mb-3 d-flex align-items-center gap-1">
          <label class="type-tracked">
            <input type="checkbox" checked="" value="idle">
            <span class="type-tracked__control idle"></span>
            <span class="type-tracked__label text-dark">Idle</span>
          </label>
        </div>
      </div>

    </div>
    <table class="table  mt-4" id="timeSheet" #timeSheet>
      <thead>
        <tr>
          <th scope="col" [appSort]="timeline" data-order="{{ sortOrder }}" data-name="users?.user"
            (click)="sortOrder = (sortOrder === 'asc' ? 'desc' : 'asc')">
            Users &nbsp;
            <i [class]="sortOrder === 'asc' ? 'bi bi-arrow-up sort-asc' : 'bi bi-arrow-down sort-desc'"></i>
          </th>

          <th scope="col" [appSort]="timeline" data-order="{{ sortOrder }}" data-name="users?.user"
            (click)="sortOrder = (sortOrder === 'asc' ? 'desc' : 'asc')">
            Projects &nbsp;
            <i [class]="sortOrder === 'asc' ? 'bi bi-arrow-up sort-asc' : 'bi bi-arrow-down sort-desc'"></i>
          </th>


          <th scope="col" [appSort]="timeline" data-order="{{ sortOrder }}" data-name="users?.user"
            (click)="sortOrder = (sortOrder === 'asc' ? 'desc' : 'asc')">
            Time &nbsp;
            <i [class]="sortOrder === 'asc' ? 'bi bi-arrow-up sort-asc' : 'bi bi-arrow-down sort-desc'"></i>
          </th>
          <th *ngFor="let hour of hours" scope="col" width="60">
            {{ startTime.getHours() + hour }}
          </th>

        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of timeline;  let i = index;">
          <td>
            <span class="letter ms-2"
              [style.background-color]="commonservice.getRandomColor(data?.logs[0]?.user?.lastName)">{{data?.logs[0]?.user?.firstName.slice(0,1)
              | uppercase}}{{data?.logs[0]?.user?.lastName.slice(0,1) | uppercase}}</span>
            {{data?.logs[0]?.user?.firstName | titlecase}} {{data?.logs[0]?.user?.lastName | titlecase}}
          </td>
          <td>{{data?.logs[0]?.project?.projectName}}</td>
          <td>
            {{ minutesToTime(data?.logs.length * 10) }}
          </td>

          <td *ngFor="let hour of hours" [style.padding]="0" class="hour">
            <ng-container *ngFor="let log of data.logs">
              <div class="hour-container"
                *ngIf="isLogInHour(log, startTime.getHours() + hour) &&
                  ((trackedChecked && getLogColor(log) === '#2ECD6F') ||
                    (mediumChecked && getLogColor(log) === '#FFC107') ||
                    (lowChecked && getLogColor(log) === '#ff0000') ||
                    (manualChecked && getLogColor(log) === '#f87a3b'))"
                [style.height.px]="40" [style.width.px]="getLogWidth(log)" [style.background-color]="getLogColor(log)"
                [tooltip]="getLogTitle(log)" [style.margin-left.px]="getLogMarginLeft(log)"
                [style.background-color]="getLogColor(log)">
              </div>
            </ng-container>
          </td>
          
        </tr>
      </tbody>
    </table>
  </div>
</div>