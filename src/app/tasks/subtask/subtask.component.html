<div class="main-content">
    <div class="container">
        <div class="row">
            <span (click)="gotoParentTask(this.subtask?.task?.parentTask)"> <button
                class="btn btn-outline-primary rounded-pill"><span
                    class="bi bi-arrow-left ">
                    Back</span></button></span>

            <div class="child-issue col-md-9">
                <div class="issue-header">
                    <div class="issue-type">Sub Task</div>
                    <div class="issue-key">
                        <h1>{{subtask?.task?.taskName}}</h1>
                    </div>
                </div>

                <div class="issue-description">
                    <h3>Description</h3>
                    <div *ngIf="!isEditMode" class="pt-2 ps-3">
                        {{subtask?.task?.description}}
                    </div>

                </div>
<!-- Starts Comments -->
<app-task-comment-list></app-task-comment-list>



<!-- Ends Comment -->
            </div>
            <div class="col-md-3">
                <div class="issue-details d-flex">
                    <div class="dropdown">
                        <button class="btn dropdown-toggle status" type="button" id="dropdownMenuButton"
                            data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" [ngClass]="{
                'bg-warning text-white!important': (selectedStatus || subtask?.task?.status) === 'In Progress',
                'bg-success text-white!important': (selectedStatus || subtask?.task?.status) === 'Done',
                'bg-danger text-white!important': (selectedStatus || subtask?.task?.status) === 'ToDo',
                'bg-secondary text-white!important': (selectedStatus || subtask?.task?.status) === 'Closed'
                
            }">
                            <i class="fa fa-tasks"></i> {{ selectedStatus ||
                            subtask?.task?.status
                            }}
                        </button>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <button *ngFor="let s of statusList" type="button" tabindex="0" role="menuitem"
                                class="dropdown-item" (click)="updatesubTaskStatus(subtask,s.name)">
                                <span class="d-flex align-items-center">
                                    <span>{{s?.name}}</span>
                                </span>
                            </button>
                            <button type="button" tabindex="0" role="menuitem" class="dropdown-item"
                                (click)="updatesubTaskStatus(subtask,'')">
                                <span class="d-flex align-items-center"><span>Remove
                                        Status</span></span>
                            </button>
                        </div>
                    </div>

                    <div class="dropdown mx-2">
                        <button class="btn dropdown-toggle" type="button" id="dropdownMenuButton"
                            data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="align-self-center"
                                [src]="selectedPriority ? selectedPriority.url : getTaskPriorityUrl(subtask?.task?.priority)"
                                [title]="selectedPriority ? selectedPriority.name : getTaskPriorityUrl(subtask?.task?.priority)"
                                height="24" width="24">
                        </button>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <button *ngFor="let priority of priorityList" type="button" tabindex="0" role="menuitem"
                                class="dropdown-item" (click)="updatesubTaskPriority(subtask,priority.name)">
                                <span class="d-flex align-items-center">
                                    <img [src]="priority?.url" class="me-3" height="18" width="18">
                                    <span>{{priority?.name}}</span>
                                </span>
                            </button>
                            <button type="button" tabindex="0" role="menuitem" class="dropdown-item"
                                (click)="updatesubTaskPriority(subtask,'')">
                                <span class="d-flex align-items-center"><span>Remove
                                        Priority</span></span>
                            </button>
                        </div>
                    </div>
                </div>



                <div class="accordion" id="accordionExample">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingOne">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                Details
                            </button>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
                            data-bs-parent="#accordionExample">
                            <div class="accordion-body p-0">
                                <div>
                                    <table>
                                        <tbody>
                                            <tr class="subTask-details">
                                                <td class="pt-0">Reporter:</td>
                                                <td class="pt-0">{{subtask?.task?.createdBy?.firstName}}
                                                    {{subtask?.task?.createdBy?.lastName}}</td>
                                            </tr>
                                            <tr class="subTask-details">
                                                <td class="pt-0">Assignee:</td>
                                                <td class="pt-0">

                                                    <div class="d-flex flex-nowrap users">
                                                        <i class="fa fa-user-plus addUser me-3 mt-1"
                                                            data-bs-toggle="modal" data-bs-target="#addUserModal"
                                                            (click)="getTaskUser(subtask?.task?.id)"></i>
                                                        <span *ngFor="let users of subtask?.newTaskUserList"
                                                            class="letter text-light"
                                                            [tooltip]="(users?.user?.firstName| titlecase) + (' ') +( users?.user?.lastName | titlecase)"
                                                            [style.background-color]="commonservice?.getRandomColor(users?.user?.firstName)">
                                                            {{users?.user?.firstName.charAt(0) | uppercase}}
                                                        </span>
                                                    </div>

                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>


                </div>
                <p class="dates mb-0 mt-2">Created On: {{subtask?.task.createdOn | date: 'mediumDate'}} </p>
                <p class="dates">Updated On: {{subtask?.task.updatedOn | date: 'mediumDate'}} </p>
            </div>
        </div>
    </div>
</div>


<!-- Add User -->
<div class="modal" id="addUserModal">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <div class=" d-flex justify-content-between">
                    <div class="">
                        <h4 class="modal-title text-start">Add New Member</h4>
                    </div>
                    <div class=""><button type="button" data-bs-dismiss="modal" class="btn-close text-end"></button>
                    </div>
                </div>
                <hr class="mt-0">
                <div class="row">
                    <form class="row" [formGroup]="addUserForm" (ngSubmit)="addUserToTask(addUserForm.value)">
                        <div class="row d-flex justify-content-center">
                            <div class="col-md-8">

                                <div class="mt-3">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-label>Select User</mat-label>
                                        <mat-select multiple formControlName="userName" [(ngModel)]="selectedUser">
                                            <mat-option *ngFor="let assignee of allAssignee" [value]="assignee.id">
                                                {{assignee?.firstName | titlecase}} {{assignee?.lastName |
                                                titlecase}}</mat-option>
                                        </mat-select>

                                    </mat-form-field>
                                </div>


                            </div>
                        </div>
                        <div class="d-flex justify-content-between m-3">

                            <div>
                                <button mat-raised-button class="mx-2" data-bs-dismiss="modal"
                                    type="button">Cancel</button>
                            </div>
                            <div>
                                <button mat-raised-button color="primary" data-bs-dismiss="modal"
                                    type="submit">Add</button>
                            </div>

                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>