<div class="main-content mt-2">
    <div class="tableContainer bg-white">
        <div class="d-flex justify-content-between align-items-center mb-2 pt-2 px-3">
            <p class="mb-0">({{templateAssignment?.length}}) Records Found</p>
            <div class="d-flex align-items-center">
                <span class="bi bi-search searchIcon"></span>

                <input class="form-control search" type="text" placeholder="Search..." name="searchText"
                    aria-label="default input example" [(ngModel)]="searchText">

                <button mat-raised-button (click)="open(addModal)" class="addBtn rounded-pill mx-3">Add
                    </button>

                <button class="submenuTab active  rounded-pill"> <i class="bi bi-download downloadBtn pe-2"></i>
                    Download</button>

            </div>
        </div>
        <table class="p-2 rounded mt-2">
            <thead>
                <tr>
                    <th [appSort]="templateAssignment" data-name="user"
                        (click)="sortOrder = (sortOrder === 'asc' ? 'desc' : 'asc')">Employee
                        <i [class]="sortOrder === 'asc' ? 'bi bi-arrow-up sort-asc' : 'bi bi-arrow-down sort-desc'"></i>
                    </th>
                    <th [appSort]="templateAssignment" data-name="leaveTemplate"
                        (click)="sortOrder = (sortOrder === 'asc' ? 'desc' : 'asc')">Current Leave Policy
                        <i [class]="sortOrder === 'asc' ? 'bi bi-arrow-up sort-asc' : 'bi bi-arrow-down sort-desc'"></i>
                    </th>
                    <th [appSort]="templateAssignment" data-name="primaryApprover"
                        (click)="sortOrder = (sortOrder === 'asc' ? 'desc' : 'asc')">Primary Supervisor
                        <i [class]="sortOrder === 'asc' ? 'bi bi-arrow-up sort-asc' : 'bi bi-arrow-down sort-desc'"></i>
                    </th>
                    <th [appSort]="templateAssignment" data-name="secondaryApprover"
                        (click)="sortOrder = (sortOrder === 'asc' ? 'desc' : 'asc')">Secondory Supervisor
                        <i [class]="sortOrder === 'asc' ? 'bi bi-arrow-up sort-asc' : 'bi bi-arrow-down sort-desc'"></i>
                    </th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let tempAssignment of templateAssignment  | search : searchText | paginate: { itemsPerPage: 5, currentPage: p }; let i = index ">
                    <td>{{getUser(tempAssignment?.user)}}</td>
                    <td>{{getTemplateLabel(tempAssignment?.leaveTemplate)}}</td>
                    <td>{{getUser(tempAssignment?.primaryApprover)}}</td>
                    <td>{{getUser(tempAssignment?.secondaryApprover)}}</td>
                    <td>
                        <button class="actions" mat-mini-fab  matTooltip="Edit" matTooltipPosition="before"
                            aria-label="Example icon button with a menu icon"
                            (click)="open(addModal); selectedLeaveAssignment = tempAssignment; editTemplateAssignment(tempAssignment)">
                            <i class="bi bi-pencil-fill"></i>
                        </button>
                        <button class="actions ms-2" mat-mini-fab matTooltip="Delete" matTooltipPosition="after"
                            aria-label="Example icon button with a menu icon"
                            (click)="deleteDialog(tempAssignment?._id)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>


    </div>
</div>

<ng-template #addModal let-modal>
    <div class="modal-body">
        <div class=" d-flex justify-content-between">
            <div class="">
                <h4 class="modal-title text-start">{{!isEdit ? 'Add' : 'Update'}} Leave Template Assignment</h4>
            </div>
            <div class=""><button type="button" (click)="modal.dismiss('Cross click')" data-bs-dismiss="modal"
                    class="btn-close text-end"></button>
            </div>
        </div>
        <hr class="mt-0">
        <div class="">
            <form class="" [formGroup]="templateAssignmentForm" (ngSubmit)="onSubmission()">
                <div class="form-group">
                    <label for="" class="">Please choose an Employee for Leave Template&nbsp;<span
                            class="text-danger">*</span></label>
                    <select name="" id="" class="form-control" formControlName="user">
                        <option [value]="user?.id" *ngFor="let user of users; let i = index">{{user?.firstName |
                            titlecase}} {{user.lastName | titlecase}}</option>

                    </select>
                </div>

                <div class="form-group mt-2">
                    <label for="" class="">Please Select a Template&nbsp;<span class="text-danger">*</span></label>
                    <select name="" id="" class="form-control" formControlName="leaveTemplate">
                        <option [value]="temp?._id" *ngFor="let temp of templates">
                            {{temp?.label}}
                        </option>
                    </select>
                </div>

                <div class="form-group mt-2">
                    <label for="" class="">Please select the Primary Approver&nbsp;<span
                            class="text-danger">*</span></label>
                    <select name="" id="" class="form-control" formControlName="primaryApprover">
                        <option [value]="user?.id" *ngFor="let user of users; let i = index">{{user?.firstName |
                            titlecase}} {{user.lastName | titlecase}}</option>

                    </select>
                </div>

                <div class="form-group mt-2">
                    <label for="" class="">Please Select the Secondary Approver&nbsp;<span
                            class="text-danger">*</span></label>
                    <select name="" id="" class="form-control" formControlName="secondaryApprover">
                        <option [value]="user?.id" *ngFor="let user of users; let i = index">{{user?.firstName |
                            titlecase}} {{user.lastName | titlecase}}</option>

                    </select>
                </div>

                <div class="my-2">

                    <div class="modal-footer d-flex justify-content-between mt-3 pb-0">

                        <div>
                            <button mat-raised-button class="mx-2" data-bs-dismiss="modal" type="reset">Cancel</button>
                        </div>
                        <div>
                            <button mat-raised-button class="addBtn" type="submit">{{!isEdit ? 'Add' :
                                'Update'}}</button>
                        </div>

                    </div>
                </div>
            </form>
        </div>
    </div>

</ng-template>